<!DOCTYPE html><html lang="ru-RU"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="profile" href="http://gmpg.org/xfn/11"> <script defer src="data:text/javascript;base64,CiAgICAgICAgKGZ1bmN0aW9uIChleHBvcnRzLCBkKSB7CiAgICAgICAgICAgIHZhciBfaXNSZWFkeSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX2V2ZW50LAogICAgICAgICAgICAgICAgX2ZucyA9IFtdOwoKICAgICAgICAgICAgZnVuY3Rpb24gb25SZWFkeShldmVudCkgewogICAgICAgICAgICAgICAgZC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgb25SZWFkeSk7CiAgICAgICAgICAgICAgICBfaXNSZWFkeSA9IHRydWU7CiAgICAgICAgICAgICAgICBfZXZlbnQgPSBldmVudDsKICAgICAgICAgICAgICAgIF9mbnMuZm9yRWFjaChmdW5jdGlvbiAoX2ZuKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZuID0gX2ZuWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2ZuWzFdOwogICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoY29udGV4dCB8fCBleHBvcnRzLCB3aW5kb3cualF1ZXJ5KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBvblJlYWR5SWUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChkLnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIpIHsKICAgICAgICAgICAgICAgICAgICBkLmRldGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBvblJlYWR5SWUpOwogICAgICAgICAgICAgICAgICAgIF9pc1JlYWR5ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBfZXZlbnQgPSBldmVudDsKICAgICAgICAgICAgICAgICAgICBfZm5zLmZvckVhY2goZnVuY3Rpb24gKF9mbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm4gPSBfZm5bMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gX2ZuWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKGNvbnRleHQgfHwgZXhwb3J0cywgZXZlbnQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBkLmFkZEV2ZW50TGlzdGVuZXIgJiYgZC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgb25SZWFkeSkgfHwKICAgICAgICAgICAgZC5hdHRhY2hFdmVudCAmJiBkLmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBvblJlYWR5SWUpOwoKICAgICAgICAgICAgZnVuY3Rpb24gZG9tUmVhZHkoZm4sIGNvbnRleHQpIHsKICAgICAgICAgICAgICAgIGlmIChfaXNSZWFkeSkgewogICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoY29udGV4dCwgX2V2ZW50KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfZm5zLnB1c2goW2ZuLCBjb250ZXh0XSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGV4cG9ydHMubWVzbWVyaXplRG9tUmVhZHkgPSBkb21SZWFkeTsKICAgICAgICB9KSh3aW5kb3csIGRvY3VtZW50KTsKICAgIA=="></script> <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' /> <script defer id="cookieyes" type="text/javascript" src="https://cdn-cookieyes.com/client_data/cf387246d0d801fe472170d3/script.js"></script> <!-- This site is optimized with the Yoast SEO plugin v21.1 - https://yoast.com/wordpress/plugins/seo/ --><title>Разворачиваем IP-телефонию на базе Asterisk с использованием дистрибутива FreePBX Distro &ndash; E-V-S BLOG</title><link rel="canonical" href="https://evs.msk.ru/voip-deploying-on-asterisk/" /><meta property="og:locale" content="ru_RU" /><meta property="og:type" content="article" /><meta property="og:title" content="Разворачиваем IP-телефонию на базе Asterisk с использованием дистрибутива FreePBX Distro &ndash; E-V-S BLOG" /><meta property="og:description" content="Asterisk &#8211; это мощное и бесплатное решение для построения собственного сервера IP-телефонии, по сути является программной Мини-IP-АТС. В этой статье разберемся как развернуть такой сервер и поговорим о его настройках. Для развертывания Asterisk мы с вами будем использовать готовый дистрибутив FreePBX Distro на базе операционной системы Sangoma Linux 7, которая в свою очередь сделана на&hellip; Читать дальше" /><meta property="og:url" content="https://evs.msk.ru/voip-deploying-on-asterisk/" /><meta property="og:site_name" content="E-V-S BLOG" /><meta property="article:published_time" content="2023-02-25T21:43:24+00:00" /><meta property="article:modified_time" content="2023-02-28T07:06:48+00:00" /><meta property="og:image" content="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1.png" /><meta name="author" content="admin" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:label1" content="Написано автором" /><meta name="twitter:data1" content="admin" /><meta name="twitter:label2" content="Примерное время для чтения" /><meta name="twitter:data2" content="33 минуты" /> <script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://evs.msk.ru/voip-deploying-on-asterisk/#article","isPartOf":{"@id":"https://evs.msk.ru/voip-deploying-on-asterisk/"},"author":{"name":"admin","@id":"https://evs.msk.ru/#/schema/person/4f434ce16fa71143dc66922a9f09a681"},"headline":"Разворачиваем IP-телефонию на базе Asterisk с использованием дистрибутива FreePBX Distro","datePublished":"2023-02-25T21:43:24+00:00","dateModified":"2023-02-28T07:06:48+00:00","mainEntityOfPage":{"@id":"https://evs.msk.ru/voip-deploying-on-asterisk/"},"wordCount":4320,"publisher":{"@id":"https://evs.msk.ru/#/schema/person/4f434ce16fa71143dc66922a9f09a681"},"image":{"@id":"https://evs.msk.ru/voip-deploying-on-asterisk/#primaryimage"},"thumbnailUrl":"https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1.png","keywords":["asterisk","freepbx"],"articleSection":["Все для Asterisk"],"inLanguage":"ru-RU"},{"@type":"WebPage","@id":"https://evs.msk.ru/voip-deploying-on-asterisk/","url":"https://evs.msk.ru/voip-deploying-on-asterisk/","name":"Разворачиваем IP-телефонию на базе Asterisk с использованием дистрибутива FreePBX Distro &ndash; E-V-S BLOG","isPartOf":{"@id":"https://evs.msk.ru/#website"},"primaryImageOfPage":{"@id":"https://evs.msk.ru/voip-deploying-on-asterisk/#primaryimage"},"image":{"@id":"https://evs.msk.ru/voip-deploying-on-asterisk/#primaryimage"},"thumbnailUrl":"https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1.png","datePublished":"2023-02-25T21:43:24+00:00","dateModified":"2023-02-28T07:06:48+00:00","breadcrumb":{"@id":"https://evs.msk.ru/voip-deploying-on-asterisk/#breadcrumb"},"inLanguage":"ru-RU","potentialAction":[{"@type":"ReadAction","target":["https://evs.msk.ru/voip-deploying-on-asterisk/"]}]},{"@type":"ImageObject","inLanguage":"ru-RU","@id":"https://evs.msk.ru/voip-deploying-on-asterisk/#primaryimage","url":"https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1.png","contentUrl":"https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1.png","width":636,"height":475},{"@type":"BreadcrumbList","@id":"https://evs.msk.ru/voip-deploying-on-asterisk/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Главная страница","item":"https://evs.msk.ru/"},{"@type":"ListItem","position":2,"name":"Разворачиваем IP-телефонию на базе Asterisk с использованием дистрибутива FreePBX Distro"}]},{"@type":"WebSite","@id":"https://evs.msk.ru/#website","url":"https://evs.msk.ru/","name":"E-V-S BLOG","description":"Техноблог Виталия Егорова","publisher":{"@id":"https://evs.msk.ru/#/schema/person/4f434ce16fa71143dc66922a9f09a681"},"alternateName":"Техноблог Виталия Егорова","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://evs.msk.ru/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"ru-RU"},{"@type":["Person","Organization"],"@id":"https://evs.msk.ru/#/schema/person/4f434ce16fa71143dc66922a9f09a681","name":"admin","image":{"@type":"ImageObject","inLanguage":"ru-RU","@id":"https://evs.msk.ru/#/schema/person/image/","url":"https://evs.msk.ru/wp-content/uploads/2023/02/cropped-alphabet-v-icon.png","contentUrl":"https://evs.msk.ru/wp-content/uploads/2023/02/cropped-alphabet-v-icon.png","width":512,"height":512,"caption":"admin"},"logo":{"@id":"https://evs.msk.ru/#/schema/person/image/"},"sameAs":["https://evs.msk.ru"],"url":"https://evs.msk.ru/author/admin/"}]}</script> <!-- / Yoast SEO plugin. --><link rel='dns-prefetch' href='//fonts.googleapis.com' /><link rel="alternate" type="application/rss+xml" title="E-V-S BLOG &raquo; Лента" href="https://evs.msk.ru/feed/" /><link rel="alternate" type="application/rss+xml" title="E-V-S BLOG &raquo; Лента комментариев" href="https://evs.msk.ru/comments/feed/" /><link rel="alternate" type="application/rss+xml" title="E-V-S BLOG &raquo; Лента комментариев к &laquo;Разворачиваем IP-телефонию на базе Asterisk с использованием дистрибутива FreePBX Distro&raquo;" href="https://evs.msk.ru/voip-deploying-on-asterisk/feed/" /><link rel='stylesheet' id='wp-block-library-css' href='https://evs.msk.ru/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' /><style id='classic-theme-styles-inline-css' type='text/css'>/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style><style id='global-styles-inline-css' type='text/css'>body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}</style><link rel='stylesheet' id='contact-form-7-css' href='https://evs.msk.ru/wp-content/cache/autoptimize/css/autoptimize_single_0e4a098f3f6e3faede64db8b9da80ba2.css' type='text/css' media='all' /><style id='contact-form-7-inline-css' type='text/css'>.wpcf7 .wpcf7-recaptcha iframe {margin-bottom: 0;}.wpcf7 .wpcf7-recaptcha[data-align="center"] > div {margin: 0 auto;}.wpcf7 .wpcf7-recaptcha[data-align="right"] > div {margin: 0 0 0 auto;}</style><link rel='stylesheet' id='sbttb-fonts-css' href='https://evs.msk.ru/wp-content/cache/autoptimize/css/autoptimize_single_441bf6460f89bba02e60bfa09861b717.css' type='text/css' media='all' /><link rel='stylesheet' id='sbttb-style-css' href='https://evs.msk.ru/wp-content/cache/autoptimize/css/autoptimize_single_59d6d023eed1937aaf22a748b87fc127.css' type='text/css' media='all' /><link rel='stylesheet' id='ivory-search-styles-css' href='https://evs.msk.ru/wp-content/plugins/add-search-to-menu/public/css/ivory-search.min.css' type='text/css' media='all' /><link rel='stylesheet' id='mesmerize-parent-css' href='https://evs.msk.ru/wp-content/themes/mesmerize/style.min.css' type='text/css' media='all' /><link rel='stylesheet' id='mesmerize-style-css' href='https://evs.msk.ru/wp-content/themes/highlight/style.min.css' type='text/css' media='all' /><style id='mesmerize-style-inline-css' type='text/css'>img.logo.dark, img.custom-logo{width:auto;max-height:70px !important;}
/** cached kirki style */@media screen and (min-width: 768px){.header{background-position:center center;}}.header-homepage:not(.header-slide).color-overlay:before{background:#000000;}.header-homepage:not(.header-slide) .background-overlay,.header-homepage:not(.header-slide).color-overlay::before{opacity:0.7;}.header-homepage-arrow{font-size:calc( 50px * 0.84 );bottom:20px;background:rgba(255,255,255,0);}.header-homepage-arrow > i.fa{width:50px;height:50px;}.header-homepage-arrow > i{color:#ffffff;}.header.color-overlay:before{background:#000000;}.header .background-overlay,.header.color-overlay::before{opacity:0.76;}.header-homepage .header-description-row{padding-top:20%;padding-bottom:20%;}.inner-header-description{padding-top:8%;padding-bottom:8%;}@media screen and (max-width:767px){.header-homepage .header-description-row{padding-top:15%;padding-bottom:15%;}}@media only screen and (min-width: 768px){.header-content .align-holder{width:80%!important;}.inner-header-description{text-align:center!important;}}</style><link rel='stylesheet' id='mesmerize-style-bundle-css' href='https://evs.msk.ru/wp-content/themes/mesmerize/assets/css/theme.bundle.min.css' type='text/css' media='all' /><link rel='stylesheet' id='mesmerize-fonts-css' href="" data-href='https://fonts.googleapis.com/css?family=Open+Sans%3A300%2C400%2C600%2C700%7CMuli%3A300%2C300italic%2C400%2C400italic%2C600%2C600italic%2C700%2C700italic%2C900%2C900italic%7CPlayfair+Display%3A400%2C400italic%2C700%2C700italic&#038;subset=latin%2Clatin-ext&#038;display=swap' type='text/css' media='all' /><link rel='stylesheet' id='tablepress-default-css' href='https://evs.msk.ru/wp-content/cache/autoptimize/css/autoptimize_single_d6c280f1424cbd0ed62afdc7cd136712.css' type='text/css' media='all' /> <script defer type='text/javascript' src='https://evs.msk.ru/wp-content/plugins/wp-yandex-metrika/assets/YmEc.min.js' id='wp-yandex-metrika_YmEc-js'></script> <script type='text/javascript' src='https://evs.msk.ru/wp-includes/js/jquery/jquery.min.js' id='jquery-core-js'></script> <script defer type='text/javascript' src='https://evs.msk.ru/wp-includes/js/jquery/jquery-migrate.min.js' id='jquery-migrate-js'></script> <script defer id="jquery-js-after" src="data:text/javascript;base64,CihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEhlYWRlclRvcFNwYWNpbmcoKSB7CgogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlclRvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXItdG9wJyk7CiAgICAgICAgICAgICAgICAgIHZhciBoZWFkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmhlYWRlci13cmFwcGVyIC5oZWFkZXIsLmhlYWRlci13cmFwcGVyIC5oZWFkZXItaG9tZXBhZ2UnKTsKCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBoZWFkZXJzW2ldOwogICAgICAgICAgICAgICAgICAgICAgaXRlbS5zdHlsZS5wYWRkaW5nVG9wID0gaGVhZGVyVG9wLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCArICJweCI7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmd1YWdlU3dpdGNoZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWVzbWVyaXplLWxhbmd1YWdlLXN3aXRjaGVyJyk7CgogICAgICAgICAgICAgICAgICAgIGlmKGxhbmd1YWdlU3dpdGNoZXIpewogICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZVN3aXRjaGVyLnN0eWxlLnRvcCA9ICJjYWxjKCAiICsgIGhlYWRlclRvcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgKyAicHggKyAxcmVtKSIgOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0sIDEwMCk7CgogICAgICAgICAgICAgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBzZXRIZWFkZXJUb3BTcGFjaW5nKTsKICAgICAgICAgICAgd2luZG93Lm1lc21lcml6ZVNldEhlYWRlclRvcFNwYWNpbmcgPSBzZXRIZWFkZXJUb3BTcGFjaW5nCiAgICAgICAgICAgIG1lc21lcml6ZURvbVJlYWR5KHNldEhlYWRlclRvcFNwYWNpbmcpOwogICAgICAgIH0pKCk7Cg=="></script> <script defer type='text/javascript' src='https://evs.msk.ru/wp-content/plugins/wp-yandex-metrika/assets/frontend.min.js' id='wp-yandex-metrika_frontend-js'></script> <script defer id="wp-yandex-metrika_frontend-js-after" src="data:text/javascript;base64,CihmdW5jdGlvbigpe3dpbmRvdy53cHltLmNvdW50ZXJzID0gSlNPTi5wYXJzZSgnW3sibnVtYmVyIjoiOTI1ODc1NjUiLCJ3ZWJ2aXNvciI6IjEifV0nKTt3aW5kb3cud3B5bS50YXJnZXRzID0gSlNPTi5wYXJzZSgnW10nKTt9KSgpOwo="></script> <link rel="https://api.w.org/" href="https://evs.msk.ru/wp-json/" /><link rel="alternate" type="application/json" href="https://evs.msk.ru/wp-json/wp/v2/posts/1042" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://evs.msk.ru/xmlrpc.php?rsd" /><meta name="generator" content="WordPress 6.3.2" /><link rel='shortlink' href='https://evs.msk.ru/?p=1042' /><link rel="alternate" type="application/json+oembed" href="https://evs.msk.ru/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fevs.msk.ru%2Fvoip-deploying-on-asterisk%2F" /><link rel="alternate" type="text/xml+oembed" href="https://evs.msk.ru/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fevs.msk.ru%2Fvoip-deploying-on-asterisk%2F&#038;format=xml" /><style type="text/css">.progress-wrap {
                    bottom: 50px;
                    height: 46px;
                    width: 46px;
                    border-radius: 46px;
                    background-color: #ffffff;
                    box-shadow: inset 0 0 0 2px #cccccc;
                }

                .progress-wrap.btn-left-side {
                    left: 50px;
                }

                .progress-wrap.btn-right-side {
                    right: 50px;
                }

                .progress-wrap::after {
                    width: 46px;
                    height: 46px;
                    color: #03a9f4;
                    font-size: 24px;
                    content: '\e90c';
                    line-height: 46px;
                }

                .progress-wrap:hover::after {
                    color: #03a9f4;
                }

                .progress-wrap svg.progress-circle path {
                    stroke: #03a9f4;
                    stroke-width: 2px;
                }</style><meta name="verification" content="f612c7d25f5690ad41496fcfdbf8d1" /> <script defer src="data:text/javascript;base64,CiAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnbGlua1tkYXRhLWhyZWZdJyk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlua3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbGlua3NbaV07CiAgICAgICAgICAgICAgICBpdGVtLmhyZWYgPSBpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1ocmVmJykKICAgICAgICAgICAgfQogICAgICAgIH0pKCk7CiAgICA="></script> <link rel="pingback" href="https://evs.msk.ru/xmlrpc.php"> <!-- Yandex.Metrica counter --> <script defer src="data:text/javascript;base64,DQogICAgICAgICAgICAoZnVuY3Rpb24gKG0sIGUsIHQsIHIsIGksIGssIGEpIHsNCiAgICAgICAgICAgICAgICBtW2ldID0gbVtpXSB8fCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIChtW2ldLmEgPSBtW2ldLmEgfHwgW10pLnB1c2goYXJndW1lbnRzKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbVtpXS5sID0gMSAqIG5ldyBEYXRlKCk7DQogICAgICAgICAgICAgICAgayA9IGUuY3JlYXRlRWxlbWVudCh0KSwgYSA9IGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUodClbMF0sIGsuYXN5bmMgPSAxLCBrLnNyYyA9IHIsIGEucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoaywgYSkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAod2luZG93LCBkb2N1bWVudCwgInNjcmlwdCIsICJodHRwczovL21jLnlhbmRleC5ydS9tZXRyaWthL3RhZy5qcyIsICJ5bSIpOw0KDQogICAgICAgICAgICB3aW5kb3cud3B5bS5lYyA9IG5ldyBZbUVjKHtkYXRhTGF5ZXJOYW1lOiAiRGF0YUxheWVyIn0pOw0KDQogICAgICAgICAgICB5bSgiOTI1ODc1NjUiLCAiaW5pdCIsIHsNCiAgICAgICAgICAgICAgICBjbGlja21hcDogdHJ1ZSwNCiAgICAgICAgICAgICAgICB0cmFja0xpbmtzOiB0cnVlLA0KICAgICAgICAgICAgICAgIGFjY3VyYXRlVHJhY2tCb3VuY2U6IHRydWUsDQogICAgICAgICAgICAgICAgd2Vidmlzb3I6IHRydWUsDQogICAgICAgICAgICAgICAgZWNvbW1lcmNlOiAiRGF0YUxheWVyIiwNCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsNCiAgICAgICAgICAgICAgICAgICAgX195bTogew0KICAgICAgICAgICAgICAgICAgICAgICAgInltQ21zUGx1Z2luIjogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjbXMiOiAid29yZHByZXNzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY21zVmVyc2lvbiI6IjYuMyIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsdWdpblZlcnNpb24iOiAiMS4xLjkiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5bUNtc1JpcCI6ICIxNzIyNjk4ODIiDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAg"></script> <!-- /Yandex.Metrica counter --><link rel="icon" href="https://evs.msk.ru/wp-content/uploads/2023/02/cropped-alphabet-v-icon-32x32.png" sizes="32x32" /><link rel="icon" href="https://evs.msk.ru/wp-content/uploads/2023/02/cropped-alphabet-v-icon-192x192.png" sizes="192x192" /><link rel="apple-touch-icon" href="https://evs.msk.ru/wp-content/uploads/2023/02/cropped-alphabet-v-icon-180x180.png" /><meta name="msapplication-TileImage" content="https://evs.msk.ru/wp-content/uploads/2023/02/cropped-alphabet-v-icon-270x270.png" /><style type="text/css" id="wp-custom-css">.post-excerpt {
    text-align: left;
}
#post-252 {
    text-align: left;
}
.col-md-8 {
    flex-basis: 100%;
    max-width: 100%;
	}</style><style type="text/css" media="screen">.is-menu path.search-icon-path { fill: #777777;}body .popup-search-close:after, body .search-close:after { border-color: #777777;}body .popup-search-close:before, body .search-close:before { border-color: #777777;}</style><style type="text/css"></style><style data-name="background-content-colors">.mesmerize-inner-page .page-content,
        .mesmerize-inner-page .content,
        .mesmerize-front-page.mesmerize-content-padding .page-content {
            background-color: #F5FAFD;
        }</style></head><body class="post-template-default single single-post postid-1042 single-format-standard mesmerize offcanvas_menu-tablet mesmerize-inner-page"><style>.screen-reader-text[href="#page-content"]:focus {
   background-color: #f1f1f1;
   border-radius: 3px;
   box-shadow: 0 0 2px 2px rgba(0, 0, 0, 0.6);
   clip: auto !important;
   clip-path: none;
   color: #21759b;

}</style><a class="skip-link screen-reader-text" href="#page-content">Перейти к контенту</a><div  id="page-top" class="header-top"><div class="navigation-bar coloured-nav"  data-sticky='0'  data-sticky-mobile='1'  data-sticky-to='top' ><div class="navigation-wrapper "><div class="row basis-auto"><div class="logo_col col-xs col-sm-fit"> <a class="text-logo" data-type="group"  data-dynamic-mod="true" href="https://evs.msk.ru/">E-V-S<span style="font-weight: 300;" class="span12"> BLOG</span></a></div><div class="main_menu_col col-xs"><div id="mainmenu_container" class="row"><ul id="main_menu" class="active-line-bottom main-menu dropdown-menu"><li id="menu-item-22" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-22"><a href="https://evs.msk.ru/category/for-windows/">Windows</a></li><li id="menu-item-21" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-21"><a href="https://evs.msk.ru/category/for-linux/">Linux</a></li><li id="menu-item-19" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-19"><a href="https://evs.msk.ru/category/for-mikrotik/">MikroTik</a></li><li id="menu-item-20" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-20"><a href="https://evs.msk.ru/category/for-asterisk/">Asterisk</a></li><li id="menu-item-588" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-588"><a href="https://evs.msk.ru/category/other/">Прочее</a></li><li id="menu-item-263" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-263"><a href="https://evs.msk.ru/about/">О сайте</a></li><li class=" astm-search-menu is-menu popup menu-item"><a title="Поиск" href="#" aria-label="Search Title Link">Поиск</a></li></ul></div> <a href="#" data-component="offcanvas" data-target="#offcanvas-wrapper" data-direction="right" data-width="300px" data-push="false"><div class="bubble"></div> <i class="fa fa-bars"></i> </a><div id="offcanvas-wrapper" class="hide force-hide  offcanvas-right"><div class="offcanvas-top"><div class="logo-holder"> <a class="text-logo" data-type="group"  data-dynamic-mod="true" href="https://evs.msk.ru/">E-V-S<span style="font-weight: 300;" class="span12"> BLOG</span></a></div></div><div id="offcanvas-menu" class="menu-%d0%be%d1%81%d0%bd%d0%be%d0%b2%d0%bd%d0%be%d0%b5-%d0%bc%d0%b5%d0%bd%d1%8e-container"><ul id="offcanvas_menu" class="offcanvas_menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-22"><a href="https://evs.msk.ru/category/for-windows/">Windows</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-21"><a href="https://evs.msk.ru/category/for-linux/">Linux</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-19"><a href="https://evs.msk.ru/category/for-mikrotik/">MikroTik</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-20"><a href="https://evs.msk.ru/category/for-asterisk/">Asterisk</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-588"><a href="https://evs.msk.ru/category/other/">Прочее</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-263"><a href="https://evs.msk.ru/about/">О сайте</a></li><li class=" astm-search-menu is-menu popup menu-item"><a title="Поиск" href="#" aria-label="Search Title Link">Поиск</a></li></ul></div></div></div></div></div></div></div><div id="page" class="site"><div class="header-wrapper"><div  class='header  color-overlay  custom-mobile-image' style='; background-image:url(&quot;https://evs.msk.ru/wp-content/uploads/2023/02/cropped-1908853-scaled-1.jpg&quot;); background-color:#6a73da' data-parallax-depth='20'><div class="inner-header-description gridContainer"><div class="row header-description-row"><div class="col-xs col-xs-12"><h1 class="hero-title"> Разворачиваем IP-телефонию на базе Asterisk с использованием дистрибутива FreePBX Distro</h1><p class="header-subtitle">Техноблог Виталия Егорова</p></div></div></div> <script defer src="data:text/javascript;base64,CgkJaWYgKHdpbmRvdy5tZXNtZXJpemVTZXRIZWFkZXJUb3BTcGFjaW5nKSB7CgkJCXdpbmRvdy5tZXNtZXJpemVTZXRIZWFkZXJUb3BTcGFjaW5nKCk7CgkJfQogICAg"></script> </div></div><div class="content post-page"><div class="gridContainer"><div class="row"><div class="col-xs-12 col-sm-12"><div class="post-item post-item-single"><div id="post-1042"class="post-1042 post type-post status-publish format-standard hentry category-for-asterisk tag-asterisk tag-freepbx"><div class="post-content-single"><h2></h2><div class="post-content-inner"><p>Asterisk &#8211; это мощное и бесплатное решение для построения собственного сервера IP-телефонии, по сути является программной Мини-IP-АТС. В этой статье разберемся как развернуть такой сервер и поговорим о его настройках.<span id="more-1042"></span></p><p>Для развертывания Asterisk мы с вами будем использовать готовый дистрибутив FreePBX Distro на базе операционной системы Sangoma Linux 7, которая в свою очередь сделана на базе CentOS. Система хорошо встает как на &#8220;железные&#8221; сервера, так и на виртуальные машины, системные требования не прихотливые &#8211; процессора на 2 ядра и 2 гигабайта оперативной памяти хватит для небольшого офиса на 30 абонентов. Если планируется большее количество абонентов, лучше увеличить количество оперативной памяти до 4 гигабайт и использовать процессор уровня Intel Core i5-6600T (или аналогичный). Скачать свежий дистрибутив можно <a href="https://www.freepbx.org/downloads/" target="_blank" rel="noopener">отсюда</a>.</p><p>Начинаем установку. Загрузочный экран встречает нас меню с выбором версии Asterisk, выберем версию 18, как он нам рекомендует, хотя я  больше предпочитаю 16 версию.</p><p><img decoding="async" fetchpriority="high" class="aligncenter size-full wp-image-1072" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1.png" alt="" width="636" height="475" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1.png 636w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_1-300x224.png 300w" sizes="(max-width: 636px) 100vw, 636px" /></p><p>Далее нам предлагают выбор режимов установки, либо с выводом по VGA, либо можно подключиться через VNC и произвести установку удаленно. Мы выберем первый вариант.</p><p><img decoding="async" class="aligncenter size-full wp-image-1073" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_2.png" alt="" width="637" height="478" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_2.png 637w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_2-300x225.png 300w" sizes="(max-width: 637px) 100vw, 637px" /></p><p>Далее выбираем FreePBX Standart и запускаем установку . Во время установки нам предложат задать пароль root, сделаем это сразу.</p><p><img decoding="async" class="aligncenter size-full wp-image-1074" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_3.png" alt="" width="1149" height="859" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_3.png 1149w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_3-300x224.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_3-1024x766.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_3-768x574.png 768w" sizes="(max-width: 1149px) 100vw, 1149px" /></p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1075" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_4.png" alt="" width="1149" height="222" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_4.png 1149w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_4-300x58.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_4-1024x198.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_4-768x148.png 768w" sizes="(max-width: 1149px) 100vw, 1149px" /></p><p>После ввода пароля нажимаем кнопку Done в левом верхнем углу.</p><p>Дожидаемся окончания установки, в конце установщик сообщит нам об этом сообщением Complete! Нажимаем кнопку Reboot и перезагружаем сервер.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1076" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_5.png" alt="" width="1147" height="860" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_5.png 1147w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_5-300x225.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_5-1024x768.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_5-768x576.png 768w" sizes="(max-width: 1147px) 100vw, 1147px" /></p><p>После перезагрузки нас поприветствует Sangoma Linux 7 и попросит ввести данные для входа в консоль. Вводим логин root и пароль, который мы задавали для root во время установки, попадаем в консоль. В самой консоли мы пока ничего делать не будем, так как для этого у нас есть полнофункциональный веб-интерфейс FreePBX, доступный по IP-адресу, который у вас высветится в консоли.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1077" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_6.png" alt="" width="629" height="693" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_6.png 629w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_6-272x300.png 272w" sizes="(max-width: 629px) 100vw, 629px" /></p><p>При первом входе в веб-интерфейс нас поприветствует FreePBX и предложит заполнить данные администратора. Заполняем под себя и нажимаем кнопку Setup System.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1079" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_7.png" alt="" width="994" height="847" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_7.png 994w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_7-300x256.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_7-768x654.png 768w" sizes="(max-width: 994px) 100vw, 994px" /></p><p>После создания учетной записи администратора мы увидим страницу приветствия. Для авторизации нажимаем кнопку FreePBX Administration, вводим наш логин и пароль и осуществляем вход.</p><p>После входа мы увидим всплывающее окно, предлагающее нам пройти активацию. Не бойтесь, активация тут абсолютно бесплатная и добровольная. Она необходима для того, чтобы вы могли пользоваться коммерческими плагинами, которые мы с вами использовать не будем, а так же получать платную техническую поддержку. Все же я рекомендую активировать ваш сервер, так как это даст дополнительные бесплатные возможности, например, доступ к модулю System Admin, к тому же это не сложно и не требует от вас много действий. Для активации необходимо будет создать учетную запись с вашим адресом электронной почты, после чего активировать сервер. Напоминаю &#8211; это бесплатно!</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1081" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_9.png" alt="" width="1009" height="851" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_9.png 1009w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_9-300x253.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_9-768x648.png 768w" sizes="(max-width: 1009px) 100vw, 1009px" /></p><p>Далее будет ряд всплывающих окон информационно-рекламного характера, на всех них нажимаем кнопку Skip, пока они все не исчезнут. Увы, бесплатные продукты любят такое.</p><p>Далее нас попросят выбрать язык голосовых подсказок, которые будут выводиться в телефонную линию, а так же язык интерфейса системы. Для России выбираем в обеих случаях &#8211; Russian, или то, что вам нужно, в конце нажимаем Submit. Кстати, Asterisk имеет неплохую русскую локализацию звуковых подсказок, сделанную на профессиональной студии.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1082" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_10.png" alt="" width="1011" height="262" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_10.png 1011w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_10-300x78.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_10-768x199.png 768w" sizes="(max-width: 1011px) 100vw, 1011px" /></p><p>Далее FreePBX уведомит нас о том, что активировал свой фирменный файрволл, который нам в локальной среде особо не нужен, но мы его отключать не будем, только позднее внесем в него некоторые правила.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1083" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_11.png" alt="" width="1009" height="513" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_11.png 1009w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_11-300x153.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_11-768x390.png 768w" sizes="(max-width: 1009px) 100vw, 1009px" /></p><p>Нажимаем Continue, соглашаемся со стандартными настройками, в конце нажимаем красную кнопку Apply Config в правом верхнем углу, применяем параметры.</p><p>И так, мы видим перед собой панель управления уже готового к использованию VoIP-сервера, который в настоящее время уже функционирует и готов выполнять свои задачи. Необходимо только сконфигурировать его под свои требования.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1085" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_12.png" alt="" width="1223" height="846" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_12.png 1223w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_12-300x208.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_12-1024x708.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_12-768x531.png 768w" sizes="(max-width: 1223px) 100vw, 1223px" /></p><p>Приступаем к настройке Asterisk. Для удобства можно переключить язык веб-интерфейса на русский язык, или продолжать настройку на английском. Мне больше нравится работать на английском языке, но для показа примеров буду использовать русский. Сразу скажу, что русская локализация интерфейса в FreePBX не полная и периодически нам будет попадаться непереведенный текст в интерфейсе. Чтобы написанный материал соответствовал сделанным мною скриншотам, в местах, где будет присутствовать английских текст, я буду так же ссылаться на английские названия, где по-русски &#8211; на русские. Если вы устанавливаете другую версию Asterisk, у вас возможно будет другая локализация, более подробная.</p><p>Перед началом основной настройки астериска назначим ему статический IP-адрес. Для этого в веб-интерфейсе переходим в &#8220;Администратор &#8211; System Admin&#8221;, в правой части переходим на Network Settings, в строке IP Assignment ставим переключатель в положение Static и задаем астериску IP-адрес в строке Static IP с указанием маски в строке Netmask и адреса вашего маршрутизатора (шлюза) в строке Gateway.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1160" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_17.png" alt="" width="1176" height="818" /></p><p>Нажимаем снизу кнопку Save Interface, видим всплывающее окно с предупреждением, чтобы вы внимательно проверили свои сетевые настройки, нажимаем в окне Save and Apply.</p><p>Далее нажимаем справа DNS, в поле DNS Server list необходимо прописать DNS-сервер вашего маршрутизатора, или указать адреса общедоступных DNS, например Google.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1164" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_18.png" alt="" width="1174" height="816" /></p><p>После ввода DNS, нажимаем внизу кнопку &#8220;Сохранить&#8221;.</p><p>Теперь откроем встроенный в FreePBX файрволл и внесем в него некоторые настройки. Для этого в веб-интерфейсе переходим в &#8220;Подключения &#8211; Firewall&#8221;.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1093" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_14.png" alt="" width="1464" height="525" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_14.png 1464w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_14-300x108.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_14-1024x367.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_14-768x275.png 768w" sizes="(max-width: 1464px) 100vw, 1464px" /></p><p>Переходим на вкладку Networks и пропишем в Network/Host вашу подсеть, в которой у вас будет работать астериск. Если подсетей несколько, указывайте все, иначе будут наблюдаться проблемы с подключением телефонов и прохождением голосового трафика. После ввода подсети, нажимайте справа зеленую кнопку с изображением плюса, подсеть добавится в исключения файрволла, далее добавляйте следующую подсеть (по необходимости). В поле Assigned Zone выбирайте по умолчанию Local (Local trusted traffic), но можете выбрать и Trusted (Excluden from Firewall)</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1095" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_15.png" alt="" width="1321" height="525" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_15.png 1321w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_15-300x119.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_15-1024x407.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_15-768x305.png 768w" sizes="(max-width: 1321px) 100vw, 1321px" /></p><p>Нажимаем внизу кнопку &#8220;Сохранить&#8221; и далее переходим на вкладку Interfaces, видим список ваших сетевых адаптеров, скорее всего он будет один, и тут необходимо в Default Zone выбрать следующее:</p><ol><li>Если ваша сетевая карта светит напрямую в интернет и имеет белый, доступный из интернета, IP-адрес, выбираем &#8211; Internet (Default Firewall).</li><li>Если ваша сетевая карта находится внутри локальной сети, за маршрутизатором, выбираем Local (Local trusted traffic).</li></ol><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1097" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_16.png" alt="" width="1463" height="764" /></p><p>В конце нажимаем кнопку Update Interfaces, далее переходим в &#8220;Настройки &#8211; Установки Asterisk для SIP&#8221;.</p><p>В разделе &#8220;Настройки NAT&#8221; в поле &#8220;Внешний адрес&#8221; будет скорее всего уже определен и прописан ваш внешний на данный момент IP-адрес, через который вы выходите в интернет через ваш маршрутизатор.</p><p>В поле &#8220;Локальные сети&#8221; должна автоматически прописаться подсеть вашей локальной сети, если у вас есть еще подсети (например удаленных филиалов, подключенных через VPN), пропишите их здесь, нажав на кнопку &#8220;Добавить параметр адреса локальной сети&#8221;. В конце нажимаем внизу кнопку &#8220;Сохранить&#8221; и &#8220;Применить настройки&#8221; (Apply Config).</p><p>Теперь можно приступить к основной настройке астериска.</p><h3>Шаг 1. Создание пула внутренних номеров (экстеншенов)</h3><p>Переходим в веб-интерфейсе &#8220;Приложения &#8211; Внутренние номера&#8221;. Видим перед собой пустую таблицу, так как номеров у нас пока никаких нет. Создадим первый номер, нажимаем кнопку &#8220;Добавить новый номер&#8221; и выбираем SIP (chan_pjsip).</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1086" src="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_13.png" alt="" width="1464" height="279" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_13.png 1464w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_13-300x57.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_13-1024x195.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/install_freepbx_16_13-768x146.png 768w" sizes="(max-width: 1464px) 100vw, 1464px" /></p><p>Откроется форма для создания нового абонента.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1088" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_1.png" alt="" width="1448" height="853" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_1.png 1448w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_1-300x177.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_1-1024x603.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_1-768x452.png 768w" sizes="(max-width: 1448px) 100vw, 1448px" /></p><p>Вообще так сложилось, что внутренняя телефония еще со времен аналоговых АТС имела в себе трехзначные номера. Помните фильм &#8220;Иван Васильевич меняет профессию&#8221;, как Милославский звонил Шпаку на работу: &#8220;Стоматологическая поликлиника? Алло! Добавочный &#8211; Три Шестьдесят Две!&#8221;. Конечно в этой комбинации, которую назвал Милославский, была своя ирония, бутылка водки в те времена стоила 3 рубля 62 копейки. Но мы с вами сейчас не про цены на водку, которые были в 70е годы СССР, а про число цифр в номерах на внутренней телефонии, 362 &#8211; три цифры.</p><p>На самом же деле вы можете использовать любое количество цифр, главное здесь не допустить пересечение внутренних номеров с номерами во внешней телефонной сети, не стоит делать номер 01, 02, 03, 112 и т.д. Хотя если ваша IP-АТС будет локальная и не будет иметь выхода во внешнюю телефонную сеть, то можно создавать вообще любые номера, но все таки лучше придерживаться классики.</p><p>Я рекомендую начинать нумерацию с тройки, первым номером пусть будет 301, вторым 302 и т.д. 300 тоже можно, на него обычно вешают ресепшн или какой ни будь внутренний колл-центр.</p><p>Назначаем нашему новому абоненту номер 301, далее пишем имя абонента, либо его роль или должность. В поле &#8220;Секрет&#8221; сгенерируется пароль для данного абонента, который будет иметь неприлично длинный набор разных символов, как бы заранее нам показывают каким должен быть пароль, но мы нашу систему Asterisk светить голой задницей в интернет не планируем, поэтому пароль лучше поменять на какой ни будь более понятный и короткий, так как в некоторых IP-телефонах и IP-шлюзах возникают проблемы с авторизацией при использовании таких длинных паролей.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1089" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_2.png" alt="" width="1446" height="853" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_2.png 1446w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_2-300x177.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_2-1024x604.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_2-768x453.png 768w" sizes="(max-width: 1446px) 100vw, 1446px" /></p><p>Больше пока никаких параметров мы здесь указывать не будем и просто нажмем кнопку &#8220;Сохранить&#8221;.</p><p>Первый абонент у нас создан, а вверху появилась красная кнопка &#8220;Сохранить изменения&#8221; (Apply Config). Для применения изменений в Asterisk всегда надо нажимать эту кнопку, если она появилась. Можно это сделать сейчас, можно позже. Каждый раз, когда вы ее нажимаете, происходит полное применение конфигурации, которое может занять время, поэтому лучше сперва произвести несколько необходимых настроек, а уже потом нажимать кнопку, чтобы не ждать долго каждый раз.</p><p>Создадим по аналогии второго абонента с номером 302.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1090" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_4.png" alt="" width="1463" height="363" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_4.png 1463w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_4-300x74.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_4-1024x254.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_4-768x191.png 768w" sizes="(max-width: 1463px) 100vw, 1463px" /></p><p>Теперь, когда у нас есть два абонента, можно нажать на кнопку &#8220;Применить изменения&#8221; и проверить телефонию, попробовав позвонить от одного абонента к другому.</p><p>Для проверки звонков можно использовать приложение <a href="https://www.microsip.org/downloads" target="_blank" rel="noopener">MicroSIP</a> для Windows или любой другой SIP-клиент, даже можно воспользоваться настоящим IP-телефоном или VoIP-шлюзом. Использовать MicroSIP для тестов удобно еще потому, что папку с дистрибутивом программы можно размножить и запускать несколько копий программы, одну с одним номером, другую &#8211; с другим. Лучше всего использовать Portable версию, тогда вам не нужно будет ее устанавливать, вы просто распакуете архив и создадите столько копий MicroSIP &#8211; сколько нужно.</p><p>Запускаем MicroSIP, нажимаем на кнопку со стрелочкой в правом верхнем углу, выбираем Add Account. В появившемся окне в поле Account Name указываем имя профиля (любое понятное нам, можно указать номер телефона), в строке SIP Server указываем IP-адреса астериска, в поле Username указываем внутренний номер подключаемого абонента, в поле Domain так же вводим IP-адрес астериска, в поле Login снова указываем номер абонента, в поле Password &#8211; пароль абонента.</p><p>По умолчанию в астериске, да и не только в нем, при использовании SIP применяется порт 5060/UDP. MicroSIP так же по умолчанию устанавливает подключение через этот порт. Если в дальнейшем будет нужда изменить этот порт на другой, то в настройках MicroSIP необходимо будет указывать IP астериска в таком виде &#8211; IP:PORT.</p><p>Должно получиться следующее:</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1098" src="https://evs.msk.ru/wp-content/uploads/2023/02/microsip_1.png" alt="" width="718" height="745" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/microsip_1.png 718w, https://evs.msk.ru/wp-content/uploads/2023/02/microsip_1-289x300.png 289w" sizes="(max-width: 718px) 100vw, 718px" /></p><p>После добавления аккаунта в MicroSIP, в нижней части программы должен загореться зеленый значок телефона и появиться статус Online. Если вы видите красный значок, значит где то ошиблись. Проверьте, правильно ли указали IP-адрес астериска, номер телефона, пароль, а так же проверьте настройки файрволла в FreePBX.</p><p>Запустим вторую копию MicroSIP с другим абонентом и попробуем позвонить от первого ко второму, в MicroSIP с номером 301 набираем номер 302 и жмем Call.</p><p>Если выскочила ошибка &#8220;Speakers and microphone both are required&#8221;, значит в вашей системе нет либо устройства вывода звука (колонок), либо устройства ввода (микрофон) и MicroSIP сообщаем нам, что без этих двух вещей поговорить по телефону не получится. Так как мы сейчас просто тестируем прохождение звонков, то в качестве микрофона (если его нет) можно использовать стерео микшер в Windows.</p><p>Если с звуковыми устройствами ввода и вывода все в порядке, то на второй MicroSIP должен прилететь звонок с определением номера и имени абонента.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1099" src="https://evs.msk.ru/wp-content/uploads/2023/02/microsip_3.png" alt="" width="637" height="494" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/microsip_3.png 637w, https://evs.msk.ru/wp-content/uploads/2023/02/microsip_3-300x233.png 300w" sizes="(max-width: 637px) 100vw, 637px" /></p><p>Попробуем от второго абонента позвонить первому, в MicroSIP с номером 302 набираем 301 и звоним.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1100" src="https://evs.msk.ru/wp-content/uploads/2023/02/microsip_4.png" alt="" width="653" height="516" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/microsip_4.png 653w, https://evs.msk.ru/wp-content/uploads/2023/02/microsip_4-300x237.png 300w" sizes="(max-width: 653px) 100vw, 653px" /></p><p>Если звонки проходят, значит связь работает. Если есть возможность поднять MicroSIP на разных компьютерах, или, например, использовать на Android-смартфоне, подключенному к вашей локальной сети по Wi-Fi, приложение Sipnetic, можно проверить голосовую связь из разных концов. В прочем, голосовую связь можно проверить и на одном компьютере, достаточно при звонке на другой MicroSIP поднять трубку и сказать что ни будь в микрофон, в колонках должны будете услышать свой голос. Главное постарайтесь поскорее завершить звонок, а то словите акустическую обратную связь (микрофонный эффект).</p><p>Если ваш голос слышен собеседнику, а его голос слышен вам &#8211; поздравляю, ваша IP-мини-АТС работает.</p><h3>Шаг 2. Создание групп вызовов и очередей</h3><p>Так же абонентов можно объединять в группы вызовов и очереди и назначать каждой их них отдельный внутренний номер. При звонке на номер группы или очереди зазвонят телефоны у всех абонентов, которые добавлены в нее.</p><p>Группа вызовов от очереди отличается тем, что распределяет звонки по всем свободным абонентам, добавленным в группу, пока кто ни будь из них не ответит на звонок. Если на звонок никто не ответит, то у звонящего по таймауту терминируется звонок (сбрасывается). Группа может принимать звонок только от одного звонящего, если на момент звонка в группу все абоненты будут заняты, то астериск сбросит абонента, или проиграет ему какое ни будь сообщение.</p><p>Очередь же держит абонента на линии до тех пор, пока один из абонентов не освободится и не ответит на звонок. При этом она имеет свойство накапливать входящие звонки, раздавая звонящим абонентам места в очереди и периодически сообщая им, на каком месте в очереди стоит их звонок (знакомая вам ситуация, когда вы пытаетесь дозвониться в какой ни будь колл-центр). Даже если включенные в очередь абоненты будут сбрасывать входящие звонки, звонящий по прежнему останется на линии и будет ждать, а абонентам периодически будут прилетать звонки от этого абонента.</p><p>Чтобы добавить пользователей в группу вызовов, переходим в &#8220;Приложения &#8211; Группы вызова&#8221; и нажмем кнопку &#8220;Добавить группу вызова&#8221;. Нам предлагается заполнить и указать различные параметры, мы затронем только несколько основных.</p><p>В поле &#8220;Номер группы вызова&#8221; указываем номер, не пересекающийся с пулом внутренних и внешних номеров. Если у вас внутренние номера начинаются на 3, то группам и очередям лучше назначать номера, начинающиеся с 4, в нашем примере группа будет иметь номер 401.</p><p>В поле &#8220;Описание группы&#8221; пишем ее название, например название отдела, чьи телефоны она будет объединять, в нашем примере будет &#8220;Отдал продаж&#8221;.</p><p>Далее в поле &#8220;Лист внутренних номеров&#8221; указываем внутренние номера абонентов, которых мы будем собирать в группу. Можно прописать номера вручную, каждый с новой строки, а можно добавить из списка &#8220;Use Quick Select&#8221;.</p><p>Дальше идет выбор стратегии обзвона, нажав на знак вопроса рядом, можно почитать что из себя представляет та или иная стратегия. Мы выберем &#8220;Звонят все&#8221;, как наиболее универсальный вариант.</p><p>В поле &#8220;Время звонка&#8221; указывается время в течение которого телефоны будут звонить, а звонящий будет находиться в ожидании вызова. По окончании заданного количества времени (максимум 300 секунд) звонок терминируется (сбрасывается), по умолчанию стоит 20 секунд.</p><p>В поле Announcement можно выбрать голосовое приветствие, которое будет воспроизводиться звонящему перед тем, как звонок от него уйдет на абонентов группы. У нас пока нет записей в системе, поэтому выбрать ничего не можем.</p><p>В поле Play Music On Hold выбирается, что будет слышать звонящий, либо обычные гудки, либо можно выбрать музыку. Для выбора музыкального сопровождения поставьте &#8220;По умолчанию&#8221;, так звонящему будет воспроизводиться плей-лист из стандартной музыкальной библиотеки астериска (неплохая музыка, кстати).</p><p>В параметре &#8220;Назначение, если никто не ответил&#8221; выбирается действие, которое происходит по истечении таймаута, заданного в поле &#8220;Время звонка&#8221;. Самое распространенное &#8211; это Terminate Call и ниже Hungup, у звонившего абонента сбросится звонок.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1115" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_12.png" alt="" width="1053" height="424" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_12.png 1053w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_12-300x121.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_12-1024x412.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_12-768x309.png 768w" sizes="(max-width: 1053px) 100vw, 1053px" /></p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1114" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_13.png" alt="" width="1052" height="87" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_13.png 1052w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_13-300x25.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_13-1024x85.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_13-768x64.png 768w" sizes="(max-width: 1052px) 100vw, 1052px" /></p><p>После указания всех настроек группы, нажимаем внизу Submit и вверху Apply Config.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1116" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_14.png" alt="" width="1176" height="258" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_14.png 1176w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_14-300x66.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_14-1024x225.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_14-768x168.png 768w" sizes="(max-width: 1176px) 100vw, 1176px" /></p><p>Теперь, если позвонить по номеру 401, мы вместо гудков услышим музыку, а у абонентов 301 и 302 зазвонят телефоны и как только один из них поднимет трубку, астериск нас соединит. Если пройдет 20 секунд и никто трубку не возьмет, астериск нас сбросит.</p><p>Теперь создадим очередь. Для ее создания переходим в &#8220;Приложения &#8211; Очереди&#8221;, нажимаем кнопку &#8220;Добавить очередь&#8221;.</p><p>Тут у нас похожая настройка, как в случае с группой вызова, так же задаем внутренний номер для создаваемой очереди, пишем ее название. У нас будет очередь, которая так же будет называться &#8220;Отдел продаж&#8221;, а номер у нее будет 402.</p><p>В поле Music on Hold Class поставим значение &#8220;По умолчанию&#8221;, а ниже выберем MoH Only. Это позволить при звонке на номер очереди вместо гудков воспроизводить музыку, загруженную в библиотеку астериска.</p><p>В поле &#8220;Назначение при неответе&#8221; как и в случае с группами, выбираем Terminate call/Hungup.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1117" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_15.png" alt="" width="1139" height="886" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_15.png 1139w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_15-300x233.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_15-1024x797.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_15-768x597.png 768w" sizes="(max-width: 1139px) 100vw, 1139px" /></p><p>Переходим на вкладку &#8220;Queue Agents&#8221; (Агенты очереди).</p><p>В поле &#8220;Статичные агенты&#8221; перечисляем номера внутренних телефонов абонентов, которых мы будем включать в данную очередь. В нашем случае наши два абонента &#8211; 301 и 302.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1118" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_16.png" alt="" width="1099" height="339" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_16.png 1099w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_16-300x93.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_16-1024x316.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_16-768x237.png 768w" sizes="(max-width: 1099px) 100vw, 1099px" /></p><p>Переходим на вкладку &#8220;Параметры времени и операторов&#8221;.</p><p>В поле Agent Timeout указываем время, в течение которого звонки из очереди будут поступать на номера абонентов включенных в очередь (операторов), можно поставить &#8220;Неограничено&#8221;, тогда звонящий на линии будет находиться до тех пор, пока ему не ответит один из операторов, либо пока он сам не сбросит звонок.</p><p>В поле &#8220;Retry&#8221; указывается промежуток времени, через который звонки из очереди будут повторно приходить на номера операторов, если он решил не поднимать трубку, или сбросил звонок. По умолчанию &#8211; 5 секунд, я обычно ставлю 30 секунд, чтобы не сводить с ума операторов очереди.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1119" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_17.png" alt="" width="1105" height="735" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_17.png 1105w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_17-300x200.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_17-1024x681.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_17-768x511.png 768w" sizes="(max-width: 1105px) 100vw, 1105px" /></p><p>Переходим на вкладку &#8220;Caller Announcements&#8221;.</p><p>В поле &#8220;Frequency&#8221; задается интервал, через который звонящему будет сообщаться о его позиции в очереди, я ставлю 1 минуту.</p><p>В поле &#8220;Minimum Announcement Interval&#8221; задается минимальный интервал времени, через который звонящему будет сообщаться его позиции в очереди, если его место в очереди изменилось.</p><p>В поле &#8220;Announce Position&#8221; указываем будет ли сообщаться звонящему о его позиции в очереди, &#8220;Да&#8221; или &#8220;Нет&#8221;. Я выбираю &#8220;Да&#8221;.</p><p>В поле &#8220;Announce Hold Time&#8221; указываем будет ли сообщаться звонящему о примерном времени до ответа оператора, я всегда ставлю &#8220;Нет&#8221;, но вы можете сделать по своему.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1120" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_18.png" alt="" width="1099" height="473" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_18.png 1099w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_18-300x129.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_18-1024x441.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_18-768x331.png 768w" sizes="(max-width: 1099px) 100vw, 1099px" /></p><p>Основные параметры очереди мы настроили. Нажимаем снизу кнопку Submit и вверху Apply Config.</p><p>Теперь если позвонить по внутреннему номеру 402, звонок уйдет операторам 301 и 302, а мы останемся на линии пока кто ни будь из операторов не освободится и не возьмет трубку.</p><h3>Шаг 4. Настройка конференций</h3><p>В Asterisk можно создавать комнаты конференций и назначать им свои внутренние номера. Каждый абонент сможет позвонить в такую конференцию, астериск примет его звонок, после чего сообщит сколько собеседников находится в комнате.</p><p>Для создания конференции переходим в &#8220;Приложения &#8211; Конференции&#8221;, нажмем кнопку Add.</p><p>В поле Conference Number зададим номер создаваемой конференции, в нашем примере будет 888.</p><p>В поле Conference Name указываем название конференции, в нашем примере &#8220;Общая конференция&#8221;.</p><p>В поле User PIN можно задать пин-код, который должен будет ввести позвонивший в конференцию абонент. Можно оставить данное поле пустым, тогда вход в конференцию будет свободным.</p><p>В поле Admin PIN задается пароль организатора конференции, для его идентификации. Это поле так же не обязательно к заполнению, если только не включен режиме ожидания организатора, без которого конференция не начнется. В таком случае пин-код необходим и он должен отличаться от пин-кода остальных участников.</p><p>Параметр Leader Wait определяет ждать ли организатора, пока он не присоединился к конференции. Если включено, конференция не начнется пока организатор не войдет в конференцию.</p><p>Параметр Leader Leave определяет завершать ли конференцию для всех участников, если организатор конференции выйдет из нее.</p><p>Параметр Music on Hold позволяет включить музыкальное сопровождение, пока в конференции находится один участник.</p><p>В строке Music on Hold Class выбирается плей-лист, в нашем случае стандартная музыка в Asterisk &#8220;По умолчанию&#8221;.</p><p>Остальные параметры трогать не будем, должно получиться следующее:</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1194" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_24.png" alt="" width="973" height="897" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_24.png 973w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_24-300x277.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_24-768x708.png 768w" sizes="(max-width: 973px) 100vw, 973px" /></p><p>Попробуем набрать номер конференции сперва у первого абонента, затем у второго. При подключении первого абонента, он услышит фразу &#8220;Вы являетесь первым участником конференции&#8221; и затем у него заиграет музыка. Как только подключится второй участник, музыка прекратит играть и раздастся звук присоединения к конференции нового участника.</p><p>Теперь все находящиеся в конференции абоненты могут общаться между собой.</p><h3> Шаг 5. Настройка SIP-транков для приема и совершения звонков во внешнюю телефонию</h3><p>Переходим в веб-интерфейсе &#8220;Подключения &#8211; Транки&#8221;, нажимаем длинную кнопку с плюсом в начале и выбираем &#8220;Добавить SIP (chan_pjsip) транк&#8221;.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1102" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_5.png" alt="" width="1464" height="383" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_5.png 1464w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_5-300x78.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_5-1024x268.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_5-768x201.png 768w" sizes="(max-width: 1464px) 100vw, 1464px" /></p><p>В качестве примера будем добавлять транк от провайдера Ростелеком.</p><p>В поле &#8220;Название транка&#8221; пишем его название, в нашем примере &#8211; Rostel. В поле &#8220;Исходящий CallerID&#8221; необходимо указать ваш внешний номер в виде 74951234567. В поле &#8220;Количество каналов&#8221; указываем максимально количество каналов на входящие и исходящие вызовы, у Ростелекома на одного пользователя доступно 2 входящих и 2 исходящих канала, ставим 2. В поле &#8220;Выключить транк&#8221; ставим переключатель в положение &#8220;Нет&#8221;, чтобы транк активировался после завершения настройки. Должно получится так:</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1105" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_6.png" alt="" width="1463" height="748" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_6.png 1463w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_6-300x153.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_6-1024x524.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_6-768x393.png 768w" sizes="(max-width: 1463px) 100vw, 1463px" /></p><p>Переходим на вкладку &#8220;pjsip Общие настройки&#8221;, заполняем данные в нижней вкладке &#8220;Общие&#8221;.</p><p>В поле &#8220;Имя пользователя&#8221; пишем имя вашего пользоваться в Ростелеком ВАТС, в поле Auth username повторяем ввод имени пользователя.</p><p>В поле &#8220;Секрет&#8221; пишем пароль пользователя в ВАТС.</p><p>В поле SIP-сервер пишем адрес вашего домена в Ростелеком ВАТС.</p><p>Порт SIP-сервера оставляем пустым, у Ростелекома он стандартный.</p><p>Если вы заполняете настройки под другого оператора и у него используется другой порт, как, например, в случае с Mango Telecom, пропишите его в поле &#8220;Порт SIP сервера&#8221;.</p><p>Транспорт оставляем UDP.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1106" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_7.png" alt="" width="1382" height="611" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_7.png 1382w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_7-300x133.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_7-1024x453.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_7-768x340.png 768w" sizes="(max-width: 1382px) 100vw, 1382px" /></p><p>Переходим во вкладку &#8220;Расширенный&#8221;.</p><p>В поле &#8220;От домена&#8221; снова указываем ваш домен в Ростелеком ВАТС.</p><p>В поле &#8220;От пользователя&#8221; повторяем ввод вашего пользователя в ВАТС.</p><p>В поле &#8220;Клиентский URI&#8221; прописываем следующую строку:</p><p><code>sip:user_rostel@123456.19.rt.ru</code></p><p>В поле &#8220;URI сервера&#8221; повторяем эту же строку.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1107" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_8.png" alt="" width="1331" height="177" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_8.png 1331w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_8-300x40.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_8-1024x136.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_8-768x102.png 768w" sizes="(max-width: 1331px) 100vw, 1331px" /></p><p>Переходим на вкладку &#8220;Кодеки&#8221; и ставим галочки на ulaw и alaw (используемые по умолчанию в Ростелеком), если у вашего оператора имеется поддержка других кодеков, отметьте их. Кодеки ulaw и alaw должны идти первыми в списке для обеспечения большей совместимости.<br /> <img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1108" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_9.png" alt="" width="1366" height="513" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_9.png 1366w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_9-300x113.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_9-1024x385.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_9-768x288.png 768w" sizes="(max-width: 1366px) 100vw, 1366px" /></p><p>Нажимаем внизу кнопку &#8220;Сохранить&#8221; и кнопку &#8220;Применить изменения&#8221; вверху.</p><p>Если вы все заполнили верно, ваш транк должен авторизоваться. Узнать о том, прошел регистрацию ваш транк на сервере Ростелекома, можно через командную строку как в самой консоли сервера, так и в веб-интерфейсе.</p><p>Чтобы узнать информацию о зарегистрированных в сети транках через веб-интерфейс, переходим в &#8220;Администратор &#8211; Командная строка Астериск&#8221; и выполняем там:</p><p><code>pjsip show registrations</code></p><p>Получаем ответ (адрес моего домена замылен), видим, что статус нашего транка &#8211; Registered.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1111" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_10.png" alt="" width="1068" height="292" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_10.png 1068w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_10-300x82.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_10-1024x280.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_10-768x210.png 768w" sizes="(max-width: 1068px) 100vw, 1068px" /></p><p>Можно узнать состояние и через саму консоль Linux, вводим и выполняем:</p><p><code>asterisk -r</code></p><p>Далее вводим и выполняем:</p><p><code>pjsip show registrations</code></p><p>Получаем ответ (адрес моего домена здесь тоже замылен):</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1112" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_11.png" alt="" width="941" height="768" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_11.png 941w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_11-300x245.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_11-768x627.png 768w" sizes="(max-width: 941px) 100vw, 941px" /></p><p>Транк добавлен в астериск и авторизован на серверах вашего провайдера.</p><h3>Шаг 6. Создание входящей и исходящей маршрутизации вызовов</h3><p>После того как у нас есть внутренние абоненты и подключен транк для принятия и совершения внешних вызовов, самое время заняться маршрутизацией, ибо без нее астериск не знает как принимать и как совершать звонки через внешнюю телефонную сеть.</p><p>Начнем с входящей маршрутизации и для начала разберемся как она работает. На астериск поступает входящий звонок через транк, далее астериск смотрит параметры входящей маршрутизации и далее возможно несколько распространенных сценариев:</p><ol><li>Звонок поступает сразу на несколько абонентов, которые объединены в группу вызовов, или в очередь вызовов.</li><li>Звонок поступает на интерактивное меню (IVR), где звонящему проиграется приветствие, а он может сделать выбор заданных направлений с помощью тональных клавиш, или набрать добавочный номер абонента.</li></ol><p>Так как мы настраиваем астериск для использования в организации, более правильным направлением для входящей маршрутизации будет именно интерактивное меню, но его нам нужно предварительно создать.</p><p>Для начала нам нужно создать аудиозапись, которая будет проигрываться звонящему в интерактивном меню. Запись можно сделать на компьютере, на смартфоне, она может быть в формате wav или mp3, астериск сам ее сконвертирует в свой формат.</p><p>Переходим в &#8220;Администратор &#8211; Записи в системе&#8221;, нажимаем кнопку &#8220;Добавить запись&#8221;, в поле Name пишем название нашей записи, например &#8220;Основное приветствие&#8221;. Затем в Upload Recording нажимаем Browse, выбираем наш аудиофайл с приветствием. Внизу, в Convert To, выбираем параметры alaw, ulaw, waw и нажимаем Sumbit и Apply Config.</p><p>Запись загружена в астериск.</p><p>Теперь создадим интерактивное меню, переходим в &#8220;Приложения &#8211; Интерактивное меню (IVR)&#8221;, нажимаем &#8220;Добавить IVR&#8221;.</p><p>Пишем название интерактивного меню, например &#8220;Основное меню&#8221;.</p><p>В поле &#8220;Уведомление&#8221; выбираем нашу запись, которую только что загрузили.</p><p>В параметре &#8220;Разрешить прямые наборы&#8221; ставим Enabled, чтобы звонящий мог набирать добавочные номера.</p><p>В параметре &#8220;Таймаут&#8221; указываем промежуток времени, который предоставляется звонящему для выполнения каких либо действий (выбрать пункт меню, или набрать добавочный), после истечения данного времени сработает параметр указанный в поле &#8220;Назначение при таймауте&#8221;, например перевод звонка на телефон секретаря, или отбой вызова.</p><p>Если включить параметр &#8220;Добавить уведомление при неверном наборе&#8221;, то звонящий будет слышать голосовое уведомление об ошибке, если он набрал неверную комбинацию.</p><p>В самом низу можно составить схему интерактивного меню, куда будет направляться звонящий при нажатии тех или иных кнопок. В нашем примере при нажатии на 1 его отправит на группу вызова &#8220;Отдел продаж&#8221;, при нажатии на 2 его отправит в очередь &#8220;Отдел продаж&#8221;, при нажатии на 3 звонок уйдет абоненту с номером 301, при нажатии на 4 звонок уйдет абоненту с номером 302.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1121" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_19.png" alt="" width="1079" height="423" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_19.png 1079w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_19-300x118.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_19-1024x401.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_19-768x301.png 768w" sizes="(max-width: 1079px) 100vw, 1079px" /></p><p>Можно создавать несколько интерактивных меню и пересекать их друг с другом.</p><p>Для сохранения меню нажимаем &#8220;Подтвердить&#8221;, после чего вверху нажимаем Apple Config. Интерактивное меню создано.</p><p>Теперь мы добрались до создания входящей маршрутизации. Переходим в веб-интерфейсе &#8220;Подключения &#8211; Входящая маршрутизация&#8221;, нажимаем кнопку &#8220;Добавить входящий маршрут&#8221;.</p><p>В поле &#8220;Описание&#8221; пишем название нашей входящей маршрутизации, например &#8220;Голосовое меню&#8221;, так как эта маршрутизация отправит всех звонящих на интерактивное меню, которое мы только что создали.</p><p>Внизу, в поле &#8220;Установить направление&#8221; выбираем &#8220;Интерактивное меню (IVR)&#8221; и ниже выбираем наше меню. Нажимаем &#8220;Сохранить&#8221; и &#8220;Применить изменения&#8221;.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1122" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_20.png" alt="" width="1174" height="814" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_20.png 1174w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_20-300x208.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_20-1024x710.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_20-768x532.png 768w" sizes="(max-width: 1174px) 100vw, 1174px" /></p><p>Теперь попробуйте позвонить на свой внешний номер транка, астериск должен будет ответить на звонок и воспроизвести вам ваше голосовое приветствие. Попробуйте понажимать кнопки 1, 2, 3, 4, проверьте как работают сценарии в интерактивном меню, потом перезвоните и попробуйте набрать добавочные 301 и 302, проверьте как уходят звонки на них.</p><p>Если астериск успешно отвечает на входящие звонки и у вас правильно отработали сценарии в IVR, значит входящая маршрутизация и интерактивное меню настроено правильно.</p><p>Теперь, когда астериск научился принимать вызовы и направлять их по нужному направлению, нам осталось настроить исходящую маршрутизацию, чтобы внутренние абоненты могли сами звонить во внешнюю телефонную сеть.</p><p>Дело в том, что астериск изначально не понимает, какие номера он должен набирать через транк и без настроек исходящей маршрутизации все набранные абонентами номера по умолчанию набирает внутри себя.</p><p>Переходим в &#8220;Подключения &#8211; Исходящая маршрутизация&#8221;, нажимаем кнопку &#8220;Добавить исходящий маршрут&#8221;.</p><p>Пишем название маршрута, например &#8220;Россия&#8221;, далее в поле &#8220;Последовательность транков для совпавших маршрутов&#8221; указываем наш транк.</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1130" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_21.png" alt="" width="1151" height="782" srcset="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_21.png 1151w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_21-300x204.png 300w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_21-1024x696.png 1024w, https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_21-768x522.png 768w" sizes="(max-width: 1151px) 100vw, 1151px" /></p><p>Переходим на вкладку &#8220;Правила набора&#8221; и вот тут нам надо указать шаблон набираемых номеров, которые астериск будет набирать в транк.</p><p>Для начала разберемся как работает исходящая маршрутизация в астериске, взглянем на таблицу:</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1131" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_22.png" alt="" width="1105" height="393" /></p><p>В поле &#8220;Совпадение маршрута&#8221; (pattern) прописывается сам шаблон номера, набор которого будет уходить в транк.</p><p>При создании шаблонов используются следующие правила ввода:</p><ul><li class="li"><strong>X</strong> &#8211; совпадение любой цифры от 0 &#8211; 9</li><li class="li"><strong>Z</strong>  &#8211; любая цифра от 1 до 9</li><li class="li"><strong>N</strong> &#8211; совпадение любой цифры от 2 &#8211; 9</li><li class="li"><strong>[1237-9]</strong> &#8211; совпадение любой цифры из набора в скобках, в том числе из указанного интервала (в данном напримере: 1,2,3,7,8,9)</li></ul><p>Например, для совершения звонков через Ростелеком шаблон будет иметь следующий вид: 8XXXXXXXXXX</p><p>В поле &#8220;Префикс&#8221; указывается код, который абонент будет набирать в начале номера, затем этот код отбрасывается из набранного номера перед его отправкой в транк.</p><p>В поле &#8220;Приставка&#8221; указывается код, который астериск добавит к набираемому номеру перед отправкой в транк.</p><p>Примеры:</p><table class="inline table table-striped table-condensed"><thead><tr><th>Приставка</th><th>Префикс</th><th>Совпадение шаблона (pattern)</th><th>Как набрано на телефоне</th><th>Как отправлено в транк</th></tr></thead><tbody><tr><td></td><td></td><td>8XXXXXXXXXX</td><td>81234567890</td><td>81234567890</td></tr><tr><td>8</td><td>+7</td><td>XXXXXXXXXX</td><td>+71234567890</td><td>81234567890</td></tr><tr><td></td><td>9</td><td>XXXXXXXXXX</td><td>91234567890</td><td>1234567890</td></tr><tr><td>+7495</td><td></td><td>NXXXXXX</td><td>1234567</td><td>+74951234567</td></tr></tbody></table><p>Так, с помощью приставок и префиксов можно производить различные конвертации набираемых номеров перед их отправкой в транк.</p><p>Для совершения городских звонков на 7-значные номера подойдет такое правило: NXXXXXX с указанием кода вашего города и кода страны в приставке.</p><p>Для совершения звонков на экстренные номера (полиция, скорая помощь, пожарная охрана) подойдет такое правило: 0[123]</p><p>Должна получится следующая таблица:</p><p><img decoding="async" loading="lazy" class="aligncenter size-full wp-image-1149" src="https://evs.msk.ru/wp-content/uploads/2023/02/setup_asterisk_23.png" alt="" width="1154" height="787" /></p><p>Нажимаем &#8220;Сохранить&#8221; и &#8220;Применить изменения&#8221;. Пробуем позвонить на внешний номер с телефона одного из абонентов, если звонок проходит &#8211; исходящая маршрутизация настроена верно.</p><h3>Заключение</h3><p>На данном этапе мы с вами произвели основные настройки астериска. Ваш астериск теперь умеет принимать звонки и отвечать на них интерактивным меню, ваши абоненты могут перезваниваться между собой, переводить вызовы друг на друга (как внутренние, так и внешние), а так же звонить во внешнюю телефонную сеть.</p></div><p class="tags-list-child">Tags: <a href="https://evs.msk.ru/tag/asterisk/" rel="tag">asterisk</a>, <a href="https://evs.msk.ru/tag/freepbx/" rel="tag">freepbx</a></p></div><nav class="navigation post-navigation" aria-label="Записи"><h2 class="screen-reader-text">Навигация по записям</h2><div class="nav-links"><div class="nav-previous"><a href="https://evs.msk.ru/transmission-on-debian/" rel="prev"><span class="meta-nav" aria-hidden="true">Предыдущий:</span> <span class="screen-reader-text">Предыдущая запись:</span> <span class="post-title">Установка Transmission на Debian</span></a></div><div class="nav-next"><a href="https://evs.msk.ru/openvpn-server-on-mikrotik/" rel="next"><span class="meta-nav" aria-hidden="true">Следующий:</span> <span class="screen-reader-text">Следующая запись:</span> <span class="post-title">Настройка OpenVPN-сервера на MikroTik</span></a></div></div></nav></div></div></div></div></div></div><div  class='footer footer-simple'><div  class='footer-content center-xs'><div class="gridContainer"><div class="row middle-xs footer-content-row"><div class="footer-content-col col-xs-12"> evs.msk.ru</div></div></div></div></div></div> <noscript><div> <img src="https://mc.yandex.ru/watch/92587565" style="position:absolute; left:-9999px;" alt=""/></div> </noscript><div class="progress-wrap btn-right-side"> <svg class="progress-circle" width="100%" height="100%" viewBox="-1 -1 102 102"> <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/> </svg></div> <script defer src="data:text/javascript;base64,DQogICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IDMwMDsNCiAgICAgICAgICAgICAgICB2YXIgZHVyYXRpb24gPSA1MDA7DQoNCiAgICAgICAgICAgICAgICBqUXVlcnkod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAJalF1ZXJ5KHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHsNCgkgICAgICAgICAgICAgICAgICAgIGlmIChqUXVlcnkodGhpcykuc2Nyb2xsVG9wKCkgPiBvZmZzZXQpIHsNCgkgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJy5wcm9ncmVzcy13cmFwJykuYWRkQ2xhc3MoJ2FjdGl2ZS1wcm9ncmVzcycpOw0KCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCgkgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJy5wcm9ncmVzcy13cmFwJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZS1wcm9ncmVzcycpOw0KCSAgICAgICAgICAgICAgICAgICAgfQ0KCSAgICAgICAgICAgICAgICB9KTsNCg0KCSAgICAgICAgICAgICAgICBqUXVlcnkoJy5wcm9ncmVzcy13cmFwJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsNCgkgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCgkgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogMH0sIGR1cmF0aW9uKTsNCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCgkgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAg"></script> <div id="is-popup-wrapper" style="display:none"><div class="popup-search-close"></div><div class="is-popup-search-form"><form role="search" method="get" class="search-form" action="https://evs.msk.ru/"> <label> <span class="screen-reader-text">Найти:</span> <input type="search" class="search-field" placeholder="Поиск&hellip;" value="" name="s"/> </label></form></div></div><script defer type='text/javascript' src='https://evs.msk.ru/wp-content/plugins/wp-yandex-metrika/assets/contactFormSeven.min.js' id='wp-yandex-metrika_contact-form-7-js'></script> <script defer type='text/javascript' src='https://evs.msk.ru/wp-content/cache/autoptimize/js/autoptimize_single_6ce86c3105139cb3c80913e6a3696a96.js' id='swv-js'></script> <script defer id="contact-form-7-js-extra" src="data:text/javascript;base64,Ci8qIDwhW0NEQVRBWyAqLwp2YXIgd3BjZjcgPSB7ImFwaSI6eyJyb290IjoiaHR0cHM6XC9cL2V2cy5tc2sucnVcL3dwLWpzb25cLyIsIm5hbWVzcGFjZSI6ImNvbnRhY3QtZm9ybS03XC92MSJ9fTsKLyogXV0+ICovCg=="></script> <script defer type='text/javascript' src='https://evs.msk.ru/wp-content/cache/autoptimize/js/autoptimize_single_5bc2b1fa970f9cecb3c30c0c92c98271.js' id='contact-form-7-js'></script> <script defer type='text/javascript' src='https://evs.msk.ru/wp-content/cache/autoptimize/js/autoptimize_single_9ee8e0f407332cb57d3f03e664ae722f.js' id='sbttb-script-js'></script> <script type='text/javascript'  defer="defer" src='https://evs.msk.ru/wp-includes/js/imagesloaded.min.js' id='imagesloaded-js'></script> <script type='text/javascript'  defer="defer" src='https://evs.msk.ru/wp-includes/js/masonry.min.js' id='masonry-js'></script> <script type='text/javascript'  defer="defer" src='https://evs.msk.ru/wp-content/themes/mesmerize/assets/js/theme.bundle.min.js' id='mesmerize-theme-js'></script> <script defer type='text/javascript' src='https://evs.msk.ru/wp-content/cache/autoptimize/js/autoptimize_single_45d47b2211079d63610ce813fb55ce20.js' id='theme-child-js'></script> <script defer type='text/javascript' src='https://evs.msk.ru/wp-content/plugins/add-search-to-menu/public/js/ivory-search.min.js' id='ivory-search-scripts-js'></script> <script defer src="data:text/javascript;base64,CiAgICAgICAgLyh0cmlkZW50fG1zaWUpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCAmJiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciAmJiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiaGFzaGNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHQsIGUgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgL15bQS16MC05Xy1dKyQvLnRlc3QoZSkgJiYgKHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKSkgJiYgKC9eKD86YXxzZWxlY3R8aW5wdXR8YnV0dG9ufHRleHRhcmVhKSQvaS50ZXN0KHQudGFnTmFtZSkgfHwgKHQudGFiSW5kZXggPSAtMSksIHQuZm9jdXMoKSkKICAgICAgICB9LCAhMSk7CiAgICA="></script> </body></html>