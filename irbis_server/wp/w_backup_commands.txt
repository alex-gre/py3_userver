База данных SQL

Критическим аспектом резервного копирования любой установки WordPress в Linux является база данных SQL.

К счастью, резервное копирование SQL на Linux очень просто.

Чтобы создать резервную копию базы данных WordPress, мы будем использовать «sqldump».

Это простой инструмент, который при правильном использовании может использоваться для легкого экспорта содержимого баз данных SQL в Linux.

Чтобы экспортировать базу данных WordPress, откройте терминал и получите корневую оболочку с su (или sudo -s, если учетная запись root отключена).

 su - 

Теперь, когда оболочка имеет полные права root, создайте новую резервную папку вместе с подкаталогами SQL и установочных файлов.

mkdir -p /root/wp-backup
mkdir -p /root/wp-backup/sql
mkdir -p /root/wp-backup/wp-installation-files

Используя команду CD, переместите терминал в подпапку sql внутри каталога wp-backup.

 cd /root/wp-backup/sql 

Затем экспортируйте базу данных WP в файл SQL на сервере Linux.

Имейте в виду, что команда sqldump не будет работать, если вы не знаете правильные данные базы данных (правильное имя БД, пользователь и пароль).

Если вы следовали инструкциям по установке WordPress на сервере Ubuntu с нашего сайта, имя базы данных WP SQL «wordpressdb», а пользователь «ubuntuwordpress».

mysqldump -u username -p databasename > db.wp__backup.sql

Запустите команду ls, чтобы подтвердить, что новый файл wp_backup.sql находится в папке /root/wp-backup/sql.

ls -a 

Когда вы можете подтвердить, что файл SQL там, резервная копия WordPress SQL завершена!
Резервное копирование WordPress

После WordPress SQL следующий шаг в процессе резервного копирования – это сохранение самой установки WordPress. Резервное копирование начинается с использования команды cp для перемещения всех файлов из /var/www/html в /root/wp-backup/wp-install-files.

В терминале используйте cp для создания полной копии текущей установки WordPress.

cp -rp /var/www/html/* /root/wp-backup/wp-installation-files/ 

Команда копирования может занять некоторое время, в зависимости от того, насколько велика ваша установка WordPress.

Когда команда cp завершает работу, перейдите в каталог резервного копирования и используйте команду ls для подтверждения наличия файлов.

Если вы заметили, что какие-либо файлы отсутствуют, может быть хорошей идеей повторно запустить команду.

cd /root/wp-backup/wp-installation-files/

ls -a

Сжатие резервной копии

Все критические файлы WordPress находятся в резервном месте.

Следующим шагом в процессе резервного копирования является сжатие всего в архив Tar.

Сжатие файлов может показаться утомительным, но это того стоит, так как будет легче архивировать и переносить резервную копию позже.

Чтобы создать новый tar-архив резервного копирования, выполните следующую команду:

tar -zcvpf wordpress-backup.tar.gz /root/wp-backup

Как только сжатие закончится, на данный момент резервная копия готова к транспортировке.

Не стесняйтесь загружать резервную копию, но будьте осторожны, чтобы она была незашифрованной.

Оставляя резервную копию незашифрованной, это очень плохая идея, тем более что это означает, что любой может просматривать файл базы данных SQL, структуру сайта и т. д.

Шифрование архива резервных копий WP легко и начинается с установки GnuPG на вашем сервере.

В диспетчере пакетов найдите «gpg» и установите его.

Затем для шифрования резервного архива используйте следующую команду.

gpg -c wordpress-backup.tar.gz

Gpg запрашивает пароль во время процесса шифрования.

Введите незарегистрированный пароль в терминал и нажмите клавишу Enter на клавиатуре.

Когда процесс шифрования завершается, выходным файлом является wordpress-backup.tar.gz.gpg.

Это безопасная форма резервного копирования и единственный файл, который вам понадобится.
Восстановить резервную копию

Нужно восстановить резервную копию? Сделайте следующее.

Во-первых, получить  оболочку root с su или sudo -s.

su -

или

sudo -s

Затем перейдите в /root и вставьте файл wordpress-backup.tar.gz.gpg.

Расшифруйте зашифрованную резервную копию:

gpg
cp -rp
.gpg

Извлеките резервный архив с помощью Tar.

tar -xvpf wordpress-backup.tar.gz

Теперь перейдите в каталог SQL и импортируйте базу данных

cd /root/wordpress-backup/sql

mysqldump -u username -p databasename < db.wp__backup.sql 

Импорт базы данных SQL мгновенно будет повторно импортировать все данные блога, информацию о пользователе, сообщения и т. д.

После этого все, что осталось, – это переместить системные файлы WordPress в нужное место.

Используя команду cp, переместите файлы на место.

cp -rp /root/wordpress-backup/* /var/www/html

Наконец, удалите архивные файлы и очистите папку /root.

rm wordpress-backup.tar.gz

rm wordpress-backup.tar.gz.gpg

rm -rf wordpress-backup