<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr"> 
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Сервер телефонии Asterisk | Русскоязычная документация по Ubuntu</title><link rel="shortcut icon" href="/lib/tpl/ubuntu-portal/images/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/ubuntu-portal/images/apple-touch-icon.png" />
        <link href='https://fonts.googleapis.com/css?family=Ubuntu:400,700,400italic,700italic&subset=latin,cyrillic'
              rel='stylesheet' type='text/css'>
                <link rel="stylesheet" type="text/css" href="https://s.ubuntu.ru/portal/ubuntu-portal.css?alarm"/>
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="fixme,администрирование,asterisk,телефония"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Русскоязычная документация по Ubuntu"/>
<link rel="start" href="/"/>
<link rel="contents" href="/wiki/asterisk?do=index" title="Все страницы"/>
<link rel="alternate" type="application/rss+xml" title="Недавние изменения" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Текущее пространство имён" href="/feed.php?mode=list&amp;ns=wiki"/>
<link rel="alternate" type="text/html" title="Простой HTML" href="/_export/xhtml/wiki/asterisk"/>
<link rel="alternate" type="text/plain" title="вики-разметка" href="/_export/raw/wiki/asterisk"/>
<link rel="canonical" href="https://help.ubuntu.ru/wiki/asterisk"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=ubuntu-portal&amp;tseed=bef559b7b29c2b8394b197c35761872f"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='wiki';var JSINFO = {"id":"wiki:asterisk","namespace":"wiki"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=ubuntu-portal&amp;tseed=bef559b7b29c2b8394b197c35761872f"></script>
<!--<![endif]-->
        <script type="text/javascript" src="https://s.ubuntu.ru/portal/ubuntu-portal.js"></script>		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-4515300-6']);
			_gaq.push(['_trackPageview']);
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
</head>
<body class="with-bottom-panel act-show">
<div id="__container">
<!-- Document -->
<div>
	<!-- Page -->
	<div id="__page">
		<div id="__wrapper"><div>
			<!-- Header -->
			<div id="__header">
	<div id="__header-menu">
		<ul>
			<li>
				<a href="https://ubuntu.ru/" title="Главная страница сайта ubuntu.ru">Сайт</a>			</li>
			<li>
				<a href="https://forum.ubuntu.ru/" title="Форум русскоязычного сообщества Ubuntu. На нём вы можете задать интересующие вас вопросы и получить помощь от других пользователей Ubuntu.">Форум</a>			</li>
			<li>
				<a href="https://help.ubuntu.ru/" title="Различная русскоязычная документация по семейству операционных систем на базе Ubuntu" class="active">Документация</a>					<div class="header-submenu">
						<div>
							<ul>
								<li>
					<a href="https://help.ubuntu.ru/wiki" title="Документация, создаваемая пользователями Ubuntu" class="active">Пользовательская документация</a>
				<div class="header-popup">
					<ul>
						<li><a href="https://help.ubuntu.ru/wiki/семейство_ubuntu" title="Документация по дистрибутивам, входящим в семейство Ubuntu">Семейство Ubuntu</a></li>
						<li><a href="https://help.ubuntu.ru/wiki/руководства" title="Различные материалы по Ubuntu, доступные для загрузки">Материалы для загрузки</a></li>
						<li><a href="https://help.ubuntu.ru/wiki/совместимость" title="Раздел, посвящённый совместимости Ubuntu с оборудованием, в первую очередь - с ноутбуками">Совместимость с оборудованием</a></li>
					</ul>
				</div></li>
								<li><a href="https://help.ubuntu.ru/doc" title="Переводы официальной документации по Ubuntu на русский язык">Официальная документация</a></li>
							</ul>
									<div id="__header-controls">			<div id="__header-user"><a href="/wiki/asterisk?do=login&amp;sectok="  class="action login" rel="nofollow" title="Войти">Войти / Зарегистрироваться</a>			</div>		</div>							<div class="clearer"></div>
						</div>
					</div>
							</li>
			<li>
				<a href="https://team.ubuntu.ru/" title="Материалы, касающиеся работы русскоязычного сообщества и русскоязычной LoCo команды Ubuntu">Сообщество</a>			</li>
			<li>
				<a href="https://ubuntu.ru/get" title="Страница получения дистрибутива Ubuntu">Скачать Ubuntu</a>			</li>
		</ul>
		<div id="__header-logo">
			<a href="https://ubuntu.ru" title="На главную страницу сайта">
				<img src="https://s.ubuntu.ru/img/logo_ru.png" alt=""/>
			</a>
		</div>
	</div>
	<div id="__search-box">
		<form action="/%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" placeholder="Найти" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><button type="submit" title="Найти">Найти</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>	</div>
</div>
			<!-- /Header -->
			<!-- Main -->
							<div id="__main">
					<div id="__main-title">
						<h1><a name="сервер_телефонии_asterisk" id="сервер_телефонии_asterisk">Сервер телефонии Asterisk</a></h1>
					</div>
					<div class="msgarea">
											</div>
					<div class="content">
						<div class="content-main dokuwiki">
							<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Содержание</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#сервер_телефонии_asterisk">Сервер телефонии Asterisk</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#общие_вопросы">Общие вопросы</a></div></li>
<li class="level2"><div class="li"><a href="#установка_из_репозитория">Установка из репозитория</a></div></li>
<li class="level2"><div class="li"><a href="#установка_из_исходников">Установка из исходников</a></div></li>
<li class="level2"><div class="li"><a href="#постскриптум">Постскриптум</a></div></li>
<li class="level2"><div class="li"><a href="#звонки_сна_skype">Звонки с/на Skype</a></div></li>
<li class="level2"><div class="li"><a href="#ссылки">Ссылки</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="level1">

<p>
<a href="http://ru.wikipedia.org/wiki/Asterisk" class="interwiki iw_wpru" title="http://ru.wikipedia.org/wiki/Asterisk">Asterisk</a> - это открытый программный сервер телефонии, значительно превосходящий по функционалу все другие существующие решения для организации офисных <a href="http://ru.wikipedia.org/wiki/Автоматическая_телефонная_станция" class="interwiki iw_wpru" title="http://ru.wikipedia.org/wiki/Автоматическая_телефонная_станция">АТС</a>, включая самые дорогие отдельные телефонные станции Enterprise класса. В сочетании с необходимым интерфейсным оборудованием, обеспечивающим подключение к компьютера к существующим телефонным сетям, Asterisk может воистину всё, что вы только способны себе представить, и даже больше. И это при том, что сам Asterisk является полностью открытым проектом - вам необходимо всего лишь купить интерфейсные платы и подходящий по мощности компьютер, и вы сможете создать АТС любого уровня и сложности. Компьютер на базе <a href="http://ru.wikipedia.org/wiki/Intel_Atom" class="interwiki iw_wpru" title="http://ru.wikipedia.org/wiki/Intel_Atom">Intel Atom</a> с пассивным охлаждением способен обслужить до 50 внутренних и внешних линий.
</p>

<p>
Голосовое меню, автоответчики, голосовая почта с доставкой аудиофайлов на email ящики, поддержка всех существующих протоколов обмена голосом и кодеков для них, видеозвонки и передача текстовой информации, возможность коммутации различных каналов, например, SIP и обычного телефона - это далеко не полный список возможностей Asterisk.
</p>

</div>

<h2 class="sectionedit2" id="общие_вопросы">Общие вопросы</h2>
<div class="level2">

<p>
Asterisk доступен в репозиториях Ubuntu, однако настоятельно рекомендуется всегда ставить самую последнюю версию с <a href="http://www.asterisk.org/" class="urlextern" title="http://www.asterisk.org/" rel="nofollow">официального сайта</a>, вручную компилируя её и все необходимые дополнительные модули.
</p>

<p>
Базовая установка Asterisk состоит из четырёх частей:
</p>
<ol>
<li class="level"><div class="li">
 Библиотека LibPRI. Эта библиотека предназначена для работы с потоковыми TDM-интерфейсами ISDN: PRI (Primary Rate Interface) и BRI (Basic Rate Interface).
</div></li>
<li class="level"><div class="li">
 Модули поддержки телекоммуникационного оборудования DAHDI.
</div></li>
<li class="level"><div class="li">
 Утилиты DAHDI.
</div></li>
<li class="level"><div class="li">
 Собственно сам сервер Asterisk.
</div></li>
</ol>


<p>
Ставить их необходимо именно в таком порядке. Если у вас нет никакого внешнего оборудования, то можно ограничиться установкой чистого Asterisk, однако разработчики всегда рекомендуют ставить полный пакет. Все необходимые пакеты с исходным кодом можно скачать на официальном сайте:
</p>
<ul>
<li class="level"><div class="li">
 <a href="http://www.asterisk.org/downloads" class="urlextern" title="http://www.asterisk.org/downloads" rel="nofollow">http://www.asterisk.org/downloads</a>
</div></li>
</ul>


<p>
Имейте ввиду, модули и утилиты DAHDI можно загрузить по отдельности, а можно в виде одного пакета DAHDI Complete. При этом в названии пакета DAHDI Complete всегда содержится два номера версии - первый для включённого в него пакета модулей DAHDI Linux, а второй - для DAHDI Tools. Вообще говоря эти номера могут и не совпадать.
</p>

<p>
Для сборки Asterisk вам потребуется компилятор GCC и некоторые сопутствующие библиотеки.Минимальный же набор необходимого можно поставить командой:
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> build-essential libncurses5-dev openssl libxml2-dev</pre>

<p>
Если вы собираете DAHDI кроме самого Asterisk, то так же понадобятся исходники ядра.
</p>

</div>

<h2 class="sectionedit3" id="установка_из_репозитория">Установка из репозитория</h2>
<div class="level2">

<p>
 Чтобы поставить всё необходимое достаточно просто запустить скрипт <code>install_prereq</code> из каталога <code>contrib/scripts/</code> в исходных текстах Asterisk с параметром <code>install</code>. Например, вот так:
</p>
<pre class="code bash"><span class="kw2">sudo</span> .<span class="sy0">/</span>contrib<span class="sy0">/</span>scripts<span class="sy0">/</span>install_prereq <span class="kw2">install</span></pre>

<p>
Однако этот скрипт ставит очень много по сути бесполезного мусора. 
<img src="/lib/images/smileys/ubuntu-portal/fixme.png" class="icon" alt="FIXME" />
</p>

</div>

<h2 class="sectionedit4" id="установка_из_исходников">Установка из исходников</h2>
<div class="level2">

<p>
В статье будет описан процесс установки для сервера 12.04. Начнем с установки необходимых библиотек и дополнительных пакетов.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> libncurses5-dev openssl libssl-dev zlib1g zlib1g-dev mpg123 linux-headers-<span class="sy0">`</span><span class="kw2">uname</span> -r<span class="sy0">`</span> build-essential mysql-server libmysqlclient15-dev php5 php5-cli php5-mysql php5-gd php-pear apache2 curl <span class="kw2">sox</span> <span class="kw2">bison</span> <span class="kw2">flex</span> <span class="kw2">cpp</span> <span class="kw2">g++</span> <span class="kw2">gcc</span> <span class="kw2">make</span> libauthen-pam-perl libio-pty-perl libnet-ssleay-perl libxml2 libxml2-dev libtiff5 libtiff5-dev libaudiofile-dev subversion libsqlite3-dev libghc-uuid-dev uuid-dev libgtk2.0-dev</pre>

<p>
<a href="http://www.asterisk.org/downloads/dahdi" class="urlextern" title="http://www.asterisk.org/downloads/dahdi" rel="nofollow">Качаем исходники DAHDI с утилитами.</a>
Распаковываем, и входим в каталог с исходниками.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">make</span> all
<span class="kw2">sudo</span> <span class="kw2">make</span> <span class="kw2">install</span>
<span class="kw2">sudo</span> <span class="kw2">make</span> config</pre>

<p>
В конце появится сообщение, что не найдены устройства DAHDI, ничего страшного. Даже если нет оборудования, драйверами эмулируется внутренний таймер, использующийся, к примеру, для корректной работы конференции.
</p>

<p>
<a href="http://www.asterisk.org/downloads/libpri/" class="urlextern" title="http://www.asterisk.org/downloads/libpri/" rel="nofollow">Качаем LibPRI.</a>
Распаковываем, и входим в каталог с исходниками.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">make</span>
<span class="kw2">sudo</span> <span class="kw2">make</span> <span class="kw2">install</span></pre>
<div class="noteclassic">Если не планируется использование факсов, этот шаг можно пропустить.
</div>
<p>
<a href="http://www.soft-switch.org/downloads/spandsp/" class="urlextern" title="http://www.soft-switch.org/downloads/spandsp/" rel="nofollow">Качаем spandsp</a>.
Распаковываем, и входим в каталог с исходниками.
</p>
<pre class="code bash">.<span class="sy0">/</span>configure
<span class="kw2">sudo</span> <span class="kw2">make</span>
<span class="kw2">sudo</span> <span class="kw2">make</span> <span class="kw2">install</span></pre>
<div class="notetip">Статья модифицирована под Asterisk 13 <abbr title="Long Term Support">LTS</abbr>, т.к. старыми версиями врядли кто уже будет пользоваться.
</div>
<p>
Как было указано выше, берем последнюю <abbr title="Long Term Support">LTS</abbr> версию с <a href="http://www.asterisk.org/" class="urlextern" title="http://www.asterisk.org/" rel="nofollow">официального сайта</a>, а именно, со <a href="http://www.asterisk.org/downloads/asterisk/all-asterisk-versions" class="urlextern" title="http://www.asterisk.org/downloads/asterisk/all-asterisk-versions" rel="nofollow">страницы загрузки</a> всех версий, распаковываем и заходим в каталог исходников. В новых версиях Asterisk необходима установка дополнительных библиотек для работы <a href="http://ru.wikipedia.org/wiki/WebRTC" class="interwiki iw_wpru" title="http://ru.wikipedia.org/wiki/WebRTC">WebRTC</a>. Для этого выполняем скрипт, входящий в комплект исходников Asterisk.
</p>
<pre class="code bash">contrib<span class="sy0">/</span>scripts<span class="sy0">/</span>install_prereq <span class="kw2">install</span></pre>

<p>
После установки библиотек необходимо установить дополнительные пакеты libsrtp и pjproject, т.к. они необходимы для работы <a href="http://ru.wikipedia.org/wiki/WebRTC" class="interwiki iw_wpru" title="http://ru.wikipedia.org/wiki/WebRTC">WebRTC</a>.
</p>
<pre class="code bash">.contrib<span class="sy0">/</span>scripts<span class="sy0">/</span>install_prereq install-unpackaged</pre>

<p>
Если вдруг возникнут ошибки, собираем всё ручками.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">su</span>
<span class="kw3">cd</span> <span class="sy0">/</span>usr<span class="sy0">/</span>src<span class="sy0">/</span>
<span class="kw2">git clone</span> https:<span class="sy0">//</span>github.com<span class="sy0">/</span>cisco<span class="sy0">/</span>libsrtp.git
<span class="kw3">cd</span> libsrtp
.<span class="sy0">/</span>configure <span class="re2">CFLAGS</span>=-fPIC
<span class="kw2">make</span> libsrtp.a
<span class="kw2">make</span> uninstall
<span class="kw2">make</span> <span class="kw2">install</span>
<span class="kw3">cd</span> ..
<span class="kw3">echo</span> <span class="st0">&quot;/usr/local/lib&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ld.so.conf.d<span class="sy0">/</span>usr_local.conf
ldconfig
&nbsp;
<span class="kw2">git clone</span> https:<span class="sy0">//</span>github.com<span class="sy0">/</span>asterisk<span class="sy0">/</span>pjproject.git
<span class="kw3">cd</span> pjproject
.<span class="sy0">/</span>configure <span class="re5">--enable-shared</span> <span class="re5">--with-external-speex</span> <span class="re5">--with-external-gsm</span> <span class="re5">--with-external-srtp</span> <span class="re5">--disable-sound</span> <span class="re5">--disable-resample</span>
<span class="kw2">make</span> dep
<span class="kw2">make</span>
<span class="kw2">make</span> <span class="kw2">install</span>
ldconfig</pre>

<p>
Жмем <kbd>Ctrl</kbd>+<kbd>D</kbd> для выхода из рутовой консоли.
</p>

<p>
Вот теперь можно продолжить установку Asterisk. Выполняем
</p>
<pre class="code bash">.<span class="sy0">/</span>configure</pre>

<p>
Если всех библиотек хватает, вы должны увидеть сообщение об успешном выполнении и лого Asterisk.
</p>

<p>
Выполняем
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">make</span> menuselect</pre>

<p>
Если вы делаете установку по ssh, то предварительно должны убедиться, что размер терминала больше, чем 80&times;25. Здесь необходимо включить нужные модули для компиляции. К примеру, в разделе Add-ons я включил модули format_mp3, app_mysql, cdr_mysql, т.к. дальше планируется установка панели управления <a href="http://freepbx.org" class="urlextern" title="http://freepbx.org" rel="nofollow">FreePBX</a>. В разделе Core Sound Packages включаем CORE-SOUNDS-EN-ALAW, CORE-SOUNDS-EN-GSM, CORE-SOUNDS-EN-G729, CORE-SOUNDS-RU-ALAW, CORE-SOUNDS-RU-GSM, CORE-SOUNDS-RU-G729 (куда же без великого и могучего <img src="/lib/images/smileys/ubuntu-portal/icon_biggrin.png" class="icon" alt=":-D" />).
</p>
<div class="notetip">Кратко поясню, для чего в трех кодеках. Для разных транков и внутренних номеров могут использоваться различные кодеки. Устанавливаемая АТС будет использовать основным кодеком alaw, потому что, к примеру, в Казахстане провайдер Казахтелеком использует для SIP телефонии как раз его и g729. В этом случае, будет использоваться меньше ресурсов сервера для транскодирования аудиопотоков. Внутренние номера так же будут использовать alaw, номера, подключаемые снаружи, через внешний интернет, будут работать на g729a, для уменьшения нагрузки на канал. В качестве терминала могут использоваться смартфоны с установленным SIP клиентом. Устойчивая связь была проверена при использовании этого кодека даже на EDGE, не говоря уже про 3G. Кодек GSM будет использоваться в GSM шлюзах.
</div><div class="noteclassic">Если планируется установка FreePBX, необходимо убедиться что для сборки отмечен модуль cdr_odbc.
</div>
<p>
Далее в разделе Music On Hold File Packages включаем модуль MOH-OPSOUND-WAV просто для того, чтоб он установился. После установки эти мелодии можно будет заменить на свои. Последний раздел Extras Sound Packages. Тут опять же включаем модули для выбранных кодеков ALAW, GSM и G729. Из корневого раздела нажимаем <kbd>Esc</kbd> и видим, что нам предложили три варианта выхода. Смело жмем <kbd>S</kbd> для сохранения сделанных изменений.
</p>

<p>
Поскольку мы включили поддежку mp3, то выполняем
</p>
<pre class="code bash">contrib<span class="sy0">/</span>scripts<span class="sy0">/</span>get_mp3_source.sh</pre>

<p>
Далее делаем
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">make</span> <span class="kw2">install</span></pre>

<p>
Пьем кофе минут 10-30, в зависимости от мощности компьютера и толщины канала. <img src="/lib/images/smileys/ubuntu-portal/icon_smile2.png" class="icon" alt="=)" /> Будут качаться архивы звуковых сообщений.
Ну вот, все скачалось, установилось. Создаем тестовые конфиги.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">make</span> samples</pre>

<p>
И мы уже можем сделать первый запуск нашей станции.
</p>
<pre class="code bash">asterisk <span class="re5">-vvvcd</span></pre>

<p>
Для того, чтоб не сочинять скрипт автозапуска выполняем
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">make</span> config</pre>

<p>
Теперь мы уже можем запустить нашу станцию как демон.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>asterisk start</pre>

<p>
И подключиться к его консоли.
</p>
<pre class="code bash"><span class="kw2">sudo</span> asterisk <span class="re5">-rvvvcd</span></pre>

<p>
Выйти из консоли можно по <kbd>Ctrl</kbd>+<kbd>Ctrl</kbd> или набрав quit и нажав <kbd>Enter</kbd>.
Осталось взять модуль кодека g729 с <a href="http://asterisk.ru/codecs/" class="urlextern" title="http://asterisk.ru/codecs/" rel="nofollow">русской страницы проекта</a>, который больше соответствует конфигурации вашего железа и положить его в /usr/lib/asterisk/modules. Затем следует перезагрузить Asterisk, или загрузить модуль из консоли управления.
</p>
<div class="notewarning">Asterisk запускается от пользователя root!
</div>
<p>
Сделаем ему отдельного пользователя, предварительно остановив Asterisk, если запустили, добавим его в нужные группы.
</p>
<pre class="code bash"><span class="kw2">sudo</span> adduser <span class="re5">--system</span> <span class="re5">--group</span> <span class="re5">--home</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk <span class="re5">--no-create-home</span> <span class="re5">--gecos</span> <span class="st0">&quot;Asterisk PBX&quot;</span> asterisk
<span class="kw2">sudo</span> adduser asterisk dialout
<span class="kw2">sudo</span> adduser asterisk audio
<span class="kw2">sudo</span> adduser www-data asterisk</pre>

<p>
Создадим каталог запуска.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>var<span class="sy0">/</span>run<span class="sy0">/</span>asterisk</pre>

<p>
Изменим права на нужные каталоги.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> asterisk:asterisk <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> asterisk:asterisk <span class="sy0">/</span>var<span class="sy0">/</span>log<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> asterisk:asterisk <span class="sy0">/</span>var<span class="sy0">/</span>run<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> asterisk:asterisk <span class="sy0">/</span>var<span class="sy0">/</span>spool<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> asterisk:asterisk <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> asterisk:asterisk <span class="sy0">/</span>dev<span class="sy0">/</span>dahdi
<span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="re2">u</span>=rwX,<span class="re2">g</span>=rX,<span class="re2">o</span>= <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="re2">u</span>=rwX,<span class="re2">g</span>=rX,<span class="re2">o</span>= <span class="sy0">/</span>var<span class="sy0">/</span>log<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="re2">u</span>=rwX,<span class="re2">g</span>=rX,<span class="re2">o</span>= <span class="sy0">/</span>var<span class="sy0">/</span>run<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="re2">u</span>=rwX,<span class="re2">g</span>=rX,<span class="re2">o</span>= <span class="sy0">/</span>var<span class="sy0">/</span>spool<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="re2">u</span>=rwX,<span class="re2">g</span>=rX,<span class="re2">o</span>= <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="re2">u</span>=rwX,<span class="re2">g</span>=rX,<span class="re2">o</span>= <span class="sy0">/</span>dev<span class="sy0">/</span>dahdi
<span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> root:asterisk <span class="sy0">/</span>etc<span class="sy0">/</span>asterisk
<span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="re2">u</span>=rwX,<span class="re2">g</span>=rX,<span class="re2">o</span>= <span class="sy0">/</span>etc<span class="sy0">/</span>asterisk</pre>

<p>
В файле /etc/default/asterisk раскомментируем две строчки.
<strong>AST_USER=«asterisk»
AST_GROUP=«dialout»</strong>
</p>

<p>
Вот теперь можно запустить Asterisk.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>asterisk start</pre>

<p>
Смотрим, от какого пользователя запустился Asterisk.
</p>
<pre class="code bash"><span class="kw2">ps</span> aux<span class="sy0">|</span><span class="kw2">grep</span> aster</pre>

<p>
Получаем.
</p>
<pre class="code bash">asterisk  <span class="nu0">2547</span>  <span class="nu0">0.1</span>  <span class="nu0">1.6</span>  <span class="nu0">40680</span> <span class="nu0">16532</span> ?        Ssl  <span class="nu0">12</span>:<span class="nu0">49</span>   <span class="nu0">0</span>:01 <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>asterisk <span class="re5">-U</span> asterisk <span class="re5">-G</span> dialout</pre>

<p>
Спокойно пользуемся дальше. <img src="/lib/images/smileys/ubuntu-portal/icon_wink.png" class="icon" alt=";-)" />
</p>

<p>
 Вот, собственно, и весь процесс установки этого замечательного продукта.
</p>

</div>

<h2 class="sectionedit5" id="постскриптум">Постскриптум</h2>
<div class="level2">

<p>
 Для ознакомления с языком программирования Asterisk, можете почитать книгу <a href="http://asterisk.ru/store/files/Asterisk_RU_OReilly_DRAFT.pdf" class="urlextern" title="http://asterisk.ru/store/files/Asterisk_RU_OReilly_DRAFT.pdf" rel="nofollow">Asterisk™ - будущее телефонии</a>. А, изучив язык программирования и структуру конфигурационных файлов Asterisk, вы будете обладать поистине безграничными возможностями «взрослой» АТС в вашем офисе. Хотя, вопреки различным оппозиционно настроенным к этому продукту людям, называть этот продукт «детской АТС» или «недостанцией», по меньшей мере, неправильно. Есть поклонники АТС Panasonis, есть Nortel. У каждой есть свои преимущества. Но нет основного, бесплатности. Тот же Panasonic берет деньги за лицензии на внешние подключения, лицензии на системный телефон, берет еще за множество вещей, которые в Asterisk уже есть. Если у вас в офисе 4-6 телефона и одна внешняя линия, тут, бесспорно, лучше взять недорогую железку, прокинуть провода и настроить АТСку как надо. При количестве телефонов больше 8, лучше уже перейти на цифру. В таких офисах уже есть, как правило, сетевая инфраструктура. Встроить в нее несколько SIP телефонов и станцию будет не сложно. О преимуществах перед аналоговой станцией говорить не приходится. Никаких подвижных контактов, коммутирующих элементов. Никаких плинтов, кроссов, если не используется аналоговая часть. Беспроблемное подключение различных VoIP и GSM шлюзов, интеграция с провайдерами IP телефонии. Объединение офисов в других городах в общее адресное пространство. Автообзвон клиентов, получение и передача данных в различные бухгалтерские и CRM системы. При всем при этом, система достаточно безопасна в пользовании при правильной настройке. Хотелось бы надеяться, что данная статья кому-то поможет установить Asterisk.
</p>
<div class="noteimportant">Удачи в освоении продукта!
</div>
<p>
<img src="/lib/images/smileys/ubuntu-portal/fixme.png" class="icon" alt="FIXME" />
</p>

</div>

<h2 class="sectionedit6" id="звонки_сна_skype">Звонки с/на Skype</h2>
<div class="level2">

<p>
Инструкция написана для Asterisk 1.8 на Ubuntu server 9.04. Задача - привязать к астериску аккаунт скайп, чтобы принимать звонки из скайпа на SIP телефон, и звонить с SIP телефона по скайпу. Для этого существует штатное расширение Asterisk производства Digium, но оно коммерческое и лицензии стоят денег. Однако, существует свободный проект - <a href="http://www.mhspot.com/sts/siptosis.html" class="urlextern" title="http://www.mhspot.com/sts/siptosis.html" rel="nofollow">SipToSis</a>, позволяющий сделать то же самое.
</p>

<p>
Для запуска Skype в консольном Linux используем Xvfb (X Virtual Frame Buffer) и для настройки Skype с другой машины - x11vnc:
</p>
<pre class="code">apt-get install xvfb x11vnc</pre>

<p>
Скачаем и установим собственно Skype:
Качаем последнюю версию с <a href="http://www.skype.com/intl/en/get-skype/on-your-computer/linux/" class="urlextern" title="http://www.skype.com/intl/en/get-skype/on-your-computer/linux/" rel="nofollow">http://www.skype.com</a>, устанавливаем:
</p>
<pre class="code">dpkg -i skype.deb</pre>

<p>
Для работы SipToSis необходима Java версии не ниже 1.5. 
</p>

<p>
Добавляем репозитарий webupd8team. Более подробную информацию можете прочитать на <a href="https://launchpad.net/~webupd8team/+archive/java" class="urlextern" title="https://launchpad.net/~webupd8team/+archive/java" rel="nofollow">https://launchpad.net/~webupd8team/+archive/java</a>
</p>
<pre class="code">sudo add-apt-repository ppa:webupd8team/java 
sudo apt-get update</pre>

<p>
Установим java:
</p>
<pre class="code">sudo apt-get install oracle-java7-installer</pre>

<p>
<a href="http://www.mhspot.com/sts/siptosis_download.php" class="urlextern" title="http://www.mhspot.com/sts/siptosis_download.php" rel="nofollow">Cкачаем SipToSis</a>.
</p>

<p>
Разархивируем в <code>/etc/siptosis</code> и проставим <code>chmod</code> на исполняемый файл:
</p>
<pre class="code">chmod +x /etc/siptosis/SipToSis_linux</pre>

<p>
<img src="/lib/images/smileys/ubuntu-portal/fixme.png" class="icon" alt="FIXME" /> man hier не согласится с этим
</p>

<p>
Теперь настроим asterisk. 
</p>

<p>
В <code>users.conf</code> добавим:
</p>
<pre class="file">[Skype]
username=Skype
type=friend
context=Skype
secret=
host=dynamic
nat=no
dtmfmode=auto
canreinvite=no
incominglimit=1
outgoinglimit=1
call-limit=1
busylevel=1</pre>

<p>
В <code>extensions.conf</code> добавим
</p>
<pre class="file">exten =&gt; 1001,1,Dial(SIP/Skype/echo123)</pre>

<p>
И перезагрузим asterisk.
</p>
<pre class="file">sudo /etc/init.d/asterisk restart</pre>

<p>
Теперь правим конфиг SipToSis:
</p>
<pre class="code">sudo nano /etc/siptosis/siptosis.cfg</pre>

<p>
Закомментируем блок настроек, начинающийся с «<em>#Sample AUTO config with NO registration</em>»
Раскомментируем блок «<em>#Sample Asterisk registration example</em>», поправим:
</p>
<pre class="file">host_port=5070
contact_url=sip:Skype@127.0.0.1:5070
from_url=&quot;Skype&quot; &lt;sip:Skype@127.0.0.1:5060&gt;
username=Skype
realm=asterisk
passwd=
expires=300
do_register=yes
minregrenewtime=120
regfailretrytime=15</pre>

<p>
Запускаем:
</p>
<pre class="code">sudo /usr/bin/Xvfb :101 -ac &amp;
sudo DISPLAY=:101 /usr/bin/skype &amp;
sudo x11vnc -display :101 &amp;</pre>

<p>
Подключаемся с другой машины (в моем случае, с Windows XP через VNC Viewer), вводим в Skype логин-пароль, отключаем все лишнее.
</p>

<p>
Теперь запускаем :
</p>
<pre class="code">DISPLAY=:101 /etc/siptosis/SipToSis_linux</pre>

<p>
Если все сделано правильно, SipToSis запустится и попытается подключиться к Skype. Skype выдаст вопрос - разрешить ли подключение. Разрешаем и ставим галку «запомнить».
</p>

<p>
Проверяем: набираем с подключенного к Asterisk клиента 1001 - мы должны услышать тестовый звонок Skype.
</p>

<p>
Чтобы принимать входящие звонки, в <code>/etc/siptosis/SkypeToSipAuth.props</code> прописываем соответствующее правило. Например:
</p>
<pre class="file">*,sip:user1@127.0.0.1:5060</pre>

<p>
 -перенаправлять все входящие звонки Skype SIP-юзеру <em>«user1»</em>.
</p>

<p>
Естественно, нужно создать в <code>extensions.conf</code> контекст «<code>Skype</code>», в котором разрешить звонки на этот extension. 
</p>

</div>

<h2 class="sectionedit7" id="ссылки">Ссылки</h2>
<div class="level2">
<ul>
<li class="level"><div class="li">
 <a href="http://asterisk.ru/store/files/Asterisk_RU_OReilly_DRAFT.pdf" class="urlextern" title="http://asterisk.ru/store/files/Asterisk_RU_OReilly_DRAFT.pdf" rel="nofollow">Asterisk: будущее телефонии</a> — книга, с которой следует начинать серьёзное знакомство с Asterisk  
</div></li>
<li class="level"><div class="li">
 <a href="https://wiki.asterisk.org/wiki/display/AST/Installing+Asterisk+From+Source" class="urlextern" title="https://wiki.asterisk.org/wiki/display/AST/Installing+Asterisk+From+Source" rel="nofollow">Статья про установку из исходников на официальном ресурсе документации Asterisk (англ.)</a>
</div></li>
<li class="level"><div class="li">
 <a href="http://www.mhspot.com/sts/siptosis.html" class="urlextern" title="http://www.mhspot.com/sts/siptosis.html" rel="nofollow">SIP to Skype Gateway</a>
</div></li>
<li class="level"><div class="li">
 <a href="http://habrahabr.ru/post/236291/" class="urlextern" title="http://habrahabr.ru/post/236291/" rel="nofollow">Подготовка Asterisk для работы с WebRTC</a>
</div></li>
</ul>

<div class="tags"><span>
	<a href="/tag/fixme?do=showtag&amp;tag=FIXME" class="wikilink1" title="tag:fixme" rel="tag">FIXME</a>,
	<a href="/tag/%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5?do=showtag&amp;tag=%D0%90%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" class="wikilink1" title="tag:администрирование" rel="tag">Администрирование</a>,
	<a href="/tag/asterisk?do=showtag&amp;tag=Asterisk" class="wikilink1" title="tag:asterisk" rel="tag">Asterisk</a>,
	<a href="/tag/%D1%82%D0%B5%D0%BB%D0%B5%D1%84%D0%BE%D0%BD%D0%B8%D1%8F?do=showtag&amp;tag=%D0%A2%D0%B5%D0%BB%D0%B5%D1%84%D0%BE%D0%BD%D0%B8%D1%8F" class="wikilink1" title="tag:телефония" rel="tag">Телефония</a>
</span></div>

</div>

							<div class="clearer"></div>
						</div>
					</div>
					<div class="clearer"></div>
				</div>
						<!-- /Main -->
		</div></div>
		<!-- Footer -->
		<div id="__site-footer">
	<ul>
		<li><a href="https://ubuntu.ru/" title="Главная страница сайта ubuntu.ru">Сайт</a></li>
		<li><a href="https://ubuntu.ru/about" title="Описание и особенности дистрибутива Ubuntu">Об Ubuntu</a></li>
		<li><a href="https://ubuntu.ru/get" title="Страница получения дистрибутива Ubuntu">Скачать Ubuntu</a></li>
		<li><a href="https://ubuntu.ru/family" title="Список дистрибутивов, входящих в большое семейство Ubuntu">Семейство Ubuntu</a></li>
		<li><a href="https://ubuntu.ru/news" title="Новости русскоязычного сообщества Ubuntu">Новости</a></li>
	</ul>
	<ul>
		<li><a href="https://forum.ubuntu.ru/" title="Форум русскоязычного сообщества Ubuntu. На нём вы можете задать интересующие вас вопросы и получить помощь от других пользователей Ubuntu.">Форум</a></li>
		<li><a href="https://forum.ubuntu.ru/index.php?action=help" title="Помощь по использованию форума">Помощь</a></li>
		<li><a href="https://forum.ubuntu.ru/index.php?action=rules" title="Правила пользования форумом русскоязычного сообщества Ubuntu">Правила</a></li>
	</ul>
	<ul>
		<li><a href="https://help.ubuntu.ru/" title="Различная русскоязычная документация по семейству операционных систем на базе Ubuntu">Документация</a></li>
		<li><a href="https://help.ubuntu.ru/wiki" title="Документация, создаваемая пользователями Ubuntu" class="active">Пользовательская документация</a></li>
		<li><a href="https://help.ubuntu.ru/doc" title="Переводы официальной документации по Ubuntu на русский язык">Официальная документация</a></li>
		<li><a href="https://help.ubuntu.ru/wiki/семейство_ubuntu" title="Документация по дистрибутивам, входящим в семейство Ubuntu">Семейство Ubuntu</a></li>
		<li><a href="https://help.ubuntu.ru/wiki/руководства" title="Различные материалы по Ubuntu, доступные для загрузки">Материалы для загрузки</a></li>
		<li><a href="https://help.ubuntu.ru/wiki/совместимость" title="Раздел, посвящённый совместимости Ubuntu с оборудованием, в первую очередь - с ноутбуками">Совместимость с оборудованием</a></li>
		<li><a href="https://help.ubuntu.ru/feed.php" title="Позволяет подписаться на обновления посредством RSS" class="rss-feed">RSS лента</a></li>
	</ul>
	<ul>
		<li><a href="https://team.ubuntu.ru/" title="Материалы, касающиеся работы русскоязычного сообщества и русскоязычной LoCo команды Ubuntu">Сообщество</a></li>
		<li><a href="https://team.ubuntu.ru/projects" title="Проекты русскоязычного сообщества Ubuntu">Наши проекты</a></li>
		<li><a href="https://team.ubuntu.ru/loco" title="Раздел, посвящённый местным сообществам Ubuntu (LoCo) в различных городах и областях">Местные сообщества</a></li>
		<li><a href="https://team.ubuntu.ru/translate" title="Раздел, посвящённый переводу Ubuntu на русский язык">Перевод Ubuntu</a></li>
		<li><a href="https://team.ubuntu.ru/qa" title="Тестирование новых версий Ubuntu">Тестирование</a></li>
		<li><a href="https://team.ubuntu.ru/feed.php" title="Позволяет подписаться на обновления посредством RSS" class="rss-feed">RSS лента</a></li>
	</ul>
	<p>
		© 2018 Ubuntu-ru — Русскоязычное сообщество Ubuntu Linux.<br />
		© 2012 Canonical Ltd. Ubuntu и Canonical являются зарегистрированными торговыми знаками Canonical Ltd.
	</p>
	<a href="https://ubuntu.ru" title="На главную страницу сайта">
		<img src="https://s.ubuntu.ru/img/footer_logo_ru.png" alt=""/>
	</a>
	<div class="clearer"></div>
</div>
		<!-- /Footer -->
	</div>
	<div class="no"><img src="/lib/exe/indexer.php?id=wiki%3Aasterisk&amp;1698426036" width="2" height="1" alt="" /></div>
	<!-- /Page -->
</div>
<!-- /Document -->
<!-- Control -->
	<div id="__control" class="pinned-down">
		<ul>
			<li><a href="/wiki/asterisk?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Показать исходный текст [V]">Показать исходный текст</a></li>
			<li><a href="/wiki/asterisk?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="История страницы [O]">История страницы</a></li>
			<li></li>
			<li><a href="/wiki/asterisk?do=backlink"  class="action backlink" rel="nofollow" title="Ссылки сюда">Ссылки сюда</a></li>
		</ul>
		<ul>
			<li id="__control_toggle">
							<a href="" title="Закрепить панель">
					<img src="https://s.ubuntu.ru/img/remmina-pin-up.png" alt="Закрепить панель" />
				</a>
						</li>
			<li></li>
			<li></li>
			<li><a href="/wiki/asterisk?do=media&amp;ns=wiki"  class="action media" rel="nofollow" title="Управление медиафайлами">Управление медиафайлами</a></li>
			<li></li>
			<li><a href="/wiki/asterisk?do=index"  class="action index" accesskey="x" rel="nofollow" title="Все страницы [X]">Все страницы</a></li>
			<li><a href="/wiki/asterisk?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Недавние изменения [R]">Недавние изменения</a></li>
		</ul>
		<div class="clearer"></div>
	</div>
<!-- /Control -->
</div>
</body>

</html>
